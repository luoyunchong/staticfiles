<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"ProjectLib_easyui.default-extension.js.html":{"id":"ProjectLib_easyui.default-extension.js.html","title":"Source: ProjectLib/easyui.default-extension.js","body":" Common Modules Global acceptauthorizeButtonbaseUrlbtnImportbytesToSizechangeCodeclearclearByIdcloseCurrentTabconfigdeleteallrowsdeletededitEditGridViewModelEditTreeGridViewModelexportExcelexportWordformatformatMsgformatYesgetSelectIdgetWebUploadGUIDIEVersionignoreEleimagePreviewDialogisNullOrEmptylinesloadFileopacityopenPostWindowpdfModalpromptscrollTosearchsetBusyshow404showChildrenspinstoptemplatetemplateImgtoTreeDatauuidwebuploader Source: ProjectLib/easyui.default-extension.js (function () { if ($.fn.datagrid) { $.extend($.fn.combotree.defaults, { lines: true, animate: true, loadFilter:com.loadAbp }); $.extend($.fn.datagrid.defaults, { fit: true, fitColumns: true, rownumbers: true, singleSelect: true, idField: 'Id', sortName: 'Id', sortOrder: 'desc', pagination: true, pageSize: 15, pageList: [15, 30, 45, 60], onBeforeLoad: function () { $('#searchForm').keydown(function (e) { if (e.which === 13) { e.preventDefault(); com.filter('#searchForm', '#dgGrid'); } }); }, onLoadError: function (a, b, c) { if (arguments[0].status == 403) { abp.message.warn(\"您无权访问此方法\", '系统提示'); } if (arguments[0].status == 500) { if (arguments[0].responseJSON) { var json = arguments[0].responseJSON.error; abp.message.warn(json.message); } } } }); $.extend($.fn.combo.defaults, { editable: false }); $.extend($.fn.combobox.defaults, { valueField: 'id', textField: 'text', editable: false, loadFilter: com.loadAbp }); $.extend($.fn.tree.defaults, { loadFilter: com.loadAbp }); $.extend($.fn.treegrid.defaults, { animate: true, fit: true, fitColumns: true, rownumbers: true, idField: 'Id', treeField: 'DisplayName', onLoadError: function (a, b, c) { if (arguments[0].status == 403) { abp.message.warn(\"您无权访问此方法\", '系统提示'); } } }); if($.fn.switchbutton!=undefined){ $.extend($.fn.switchbutton.defaults, { width: 46, height: 22, onText: \"是\", offText: \"否\", isBool: true }); } /*JQuery EasyUI 扩展*/ $.extend($.fn.validatebox.defaults.rules, { //扩展下拉验证==请选择==,使用方法, validType=\"comboxValidate['From','请选择状态']\" //当下菜单选定的值为请选择时，会显示一个提示信息：请选择状态 //author:luozQ comboxValidate: { validator: function (value, param, missingMessage) { //var data = $('#' + param).combobox('getText'); //debugger; if (value != '' &amp;&amp; value != null &amp;&amp; value != \"==请选择==\") { return true; } return false; }, message: \"{0}\" }, //param是参数名 //selector是该参数的选择器,重写remote时根据选择器取到参数值 //validType=\"remote['/group/validCode','code',{'param':'id\"','selector':'#id'},'编码不唯一']\" remote: { validator: function (value, param) { if (!value) { return true; } var data = {}; data[param[1]] = value; // param[2] 就是配置的{param:'id',selector:'id'} if (param[2]) { data[param[2].param] = $(param[2].selector).val(); } var res = $.ajax({ url: param[0], dataType: \"json\", data: data, async: false, cache: false, type: \"post\" }).responseText; return res === \"true\"; }, message: \"{3}\" } }); /** * 1）扩展jquery easyui tree的节点检索方法。使用方法如下： * $(\"#treeId\").tree(\"search\", searchText); * 其中，treeId为easyui tree的根UL元素的ID，searchText为检索的文本。 * 如果searchText为空或\"\"，将恢复展示所有节点为正常状态 */ (function ($) { $.extend($.fn.tree.methods, { /** * 扩展easyui tree的搜索方法 * @param tree easyui tree的根DOM节点(UL节点)的jQuery对象 * @param searchText 检索的文本 * @param this-context easyui tree的tree对象 */ search: function (jqTree, searchText) { //easyui tree的tree对象。可以通过tree.methodName(jqTree)方式调用easyui tree的方法 var tree = this; //获取所有的树节点 var nodeList = getAllNodes(jqTree, tree); //如果没有搜索条件，则展示所有树节点 searchText = $.trim(searchText); if (searchText == \"\") { for (var i = 0; i &lt; nodeList.length; i++) { $(\".tree-node-targeted\", nodeList[i].target).removeClass(\"tree-node-targeted\"); $(nodeList[i].target).show(); } //展开已选择的节点（如果之前选择了） var selectedNode = tree.getSelected(jqTree); if (selectedNode) { tree.expandTo(jqTree, selectedNode.target); } return; } //搜索匹配的节点并高亮显示 var matchedNodeList = []; if (nodeList &amp;&amp; nodeList.length &gt; 0) { var node = null; for (var i = 0; i &lt; nodeList.length; i++) { node = nodeList[i]; if (isMatch(searchText, node.text)) { matchedNodeList.push(node); } else if (node.sampleCode != undefined &amp;&amp; node.sampleCode.indexOf(searchText) != -1) { matchedNodeList.push(node); } } //隐藏所有节点 for (var i = 0; i &lt; nodeList.length; i++) { $(\".tree-node-targeted\", nodeList[i].target).removeClass(\"tree-node-targeted\"); $(nodeList[i].target).hide(); } //折叠所有节点 tree.collapseAll(jqTree); //展示所有匹配的节点以及父节点 for (var i = 0; i &lt; matchedNodeList.length; i++) { showMatchedNode(jqTree, tree, matchedNodeList[i]); } } }, /** * 展示节点的子节点（子节点有可能在搜索的过程中被隐藏了） * @param node easyui tree节点 */ showChildren: function (jqTree, node) { //easyui tree的tree对象。可以通过tree.methodName(jqTree)方式调用easyui tree的方法 var tree = this; //展示子节点 if (!tree.isLeaf(jqTree, node.target)) { var children = tree.getChildren(jqTree, node.target); if (children &amp;&amp; children.length &gt; 0) { for (var i = 0; i &lt; children.length; i++) { if ($(children[i].target).is(\":hidden\")) { $(children[i].target).show(); } } } } }, /** * 将滚动条滚动到指定的节点位置，使该节点可见（如果有滚动条才滚动，没有滚动条就不滚动） * @param param { * treeContainer: easyui tree的容器（即存在滚动条的树容器）。如果为null，则取easyui tree的根UL节点的父节点。 * targetNode: 将要滚动到的easyui tree节点。如果targetNode为空，则默认滚动到当前已选中的节点，如果没有选中的节点，则不滚动 * } */ scrollTo: function (jqTree, param) { //easyui tree的tree对象。可以通过tree.methodName(jqTree)方式调用easyui tree的方法 var tree = this; //如果node为空，则获取当前选中的node var targetNode = param &amp;&amp; param.targetNode ? param.targetNode : tree.getSelected(jqTree); if (targetNode != null) { //判断节点是否在可视区域 var root = tree.getRoot(jqTree); var $targetNode = $(targetNode.target); var container = param &amp;&amp; param.treeContainer ? param.treeContainer : jqTree.parent(); var containerH = container.height(); var nodeOffsetHeight = $targetNode.offset().top - container.offset().top; if (nodeOffsetHeight &gt; (containerH - 30)) { var scrollHeight = container.scrollTop() + nodeOffsetHeight - containerH + 30; container.scrollTop(scrollHeight); } } } }); /** * 展示搜索匹配的节点 */ function showMatchedNode(jqTree, tree, node) { //展示所有父节点 $(node.target).show(); $(\".tree-title\", node.target).addClass(\"tree-node-targeted\"); var pNode = node; while ((pNode = tree.getParent(jqTree, pNode.target))) { $(pNode.target).show(); } //展开到该节点 tree.expandTo(jqTree, node.target); //如果是非叶子节点，需折叠该节点的所有子节点 if (!tree.isLeaf(jqTree, node.target)) { tree.collapse(jqTree, node.target); } } /** * 判断searchText是否与targetText匹配 * @param searchText 检索的文本 * @param targetText 目标文本 * @return true-检索的文本与目标文本匹配；否则为false. */ function isMatch(searchText, targetText) { return $.trim(targetText) != \"\" &amp;&amp; targetText.indexOf(searchText) != -1; } /** * 获取easyui tree的所有node节点 */ function getAllNodes(jqTree, tree) { //var allNodeList = jqTree.data(\"allNodeList\"); //if (!allNodeList) { // var roots = tree.getRoots(jqTree); // allNodeList = getChildNodeList(jqTree, tree, roots); // jqTree.data(\"allNodeList\", allNodeList); //} //return allNodeList; var allNodeList = jqTree.tree(\"getChildren\"); return allNodeList; } /** * 定义获取easyui tree的子节点的递归算法 */ function getChildNodeList(jqTree, tree, nodes) { var childNodeList = []; if (nodes &amp;&amp; nodes.length &gt; 0) { var node = null; for (var i = 0; i &lt; nodes.length; i++) { node = nodes[i]; childNodeList.push(node); if (!tree.isLeaf(jqTree, node.target)) { var children = tree.getChildren(jqTree, node.target); childNodeList = childNodeList.concat(getChildNodeList(jqTree, tree, children)); } } } return childNodeList; } })(jQuery); } })(); /** * 序列化表单字段。 */ $.fn.formSerialize = function () { var $form = $(this); var postdata = {}; $form.find('input,select,textarea').each(function (r) { var $this = $(this); var id = $this.attr('id'); if (id == undefined || id.indexOf(\"_easyui_textbox_input\") !== -1 || $this.hasClass('hiddenInput')) { return; } switch (true) { case $this.is(\"[class*=easyui-switchbutton]\"): var opts = $this.switchbutton('options'); var isChecked = $this.switchbutton('options').checked; //根据switchbutton扩展的属性，isBool为ture时，说明本控件后台存储ture,false， //菜单管理下的是否启用，采用1, 0; 增加isBool: false if (opts.isBool) { postdata[id] = isChecked; } else { postdata[id] = isChecked ? 1 : 0; } break; case $this.is(\"[class*=combotree-f]\"): if ($this.combotree('options').multiple == true) { postdata[id] = $this.combotree('getValues'); } else { postdata[id] = $this.combotree('getValue'); } break; case $this.is(\"[class*=easyui-checkbox]\"): postdata[id] = $this.checkbox('isCheck'); break; case $this.is(\"[class*=combobox-f]\"): postdata[id] = $this.combobox('getValues').toString(); break; case $this.is(\"[class*=easyui-comboicons]\"): postdata[id] = $this.comboicons('getValue'); break; case $this.is(\"[class*=easyui-datebox]\"): postdata[id] = $this.datebox('getValue'); break; case $this.is(\"[class*=radiobox-f]\"): postdata[$this.attr('radioboxname')] = $('.' + $this.attr('radioboxname')).radiobox('getValues'); break; default: postdata[id] = $this.val(); break; } }); $form.find('.webuploader-container').parent().parent().each(function (r) { var $this = $(this); var id = $this.attr('id'); postdata[id] = $this.GetFilesAddress(); }); return postdata; }; × Search results Close "},"libs_abp.webuploader.js.html":{"id":"libs_abp.webuploader.js.html","title":"Source: libs/abp.webuploader.js","body":" Common Modules Global acceptauthorizeButtonbaseUrlbtnImportbytesToSizechangeCodeclearclearByIdcloseCurrentTabconfigdeleteallrowsdeletededitEditGridViewModelEditTreeGridViewModelexportExcelexportWordformatformatMsgformatYesgetSelectIdgetWebUploadGUIDIEVersionignoreEleimagePreviewDialogisNullOrEmptylinesloadFileopacityopenPostWindowpdfModalpromptscrollTosearchsetBusyshow404showChildrenspinstoptemplatetemplateImgtoTreeDatauuidwebuploader Source: libs/abp.webuploader.js /** * 上传控件实现 * @example 该js还是依赖于以下js &lt;link href=\"~/bower_components/font-awesome/css/font-awesome.min.css\" rel=\"stylesheet\" /&gt; &lt;script src=\"~/bower_components/jquery/jquery.min.js\"&gt;&lt;/script&gt; &lt;script src=\"~/bower_components/layer/layer.js\"&gt;&lt;/script&gt; &lt;script src=\"~/Scripts/libs/abp.js\"&gt;&lt;/script&gt; &lt;script src=\"~/Scripts/libs/abp.layui-alert.js\"&gt;&lt;/script&gt; */ var webuploader = webuploader || {}; var abp = abp || {}; /* * abp.webuploader.js 是扩展上传文件，有一定的上传样式效果，依赖于jquery,layer,abp.js,abp.layui-alert.js,font-awesomen.css * 还改了webuploader.js 3949行，解决了fileNumLimit上传文件数量无效的问题 和webuploader.min.js对应的js文件 * 本文件会自动引用applicationPath目录下的webuploader.min.js和webuploader.css文件 */ (function ($, window) { var applicationPath = window.applicationPath === \"\" ? \"\" : window.applicationPath || \"/bower_components/webuploader\"; // var serviceUrl = \"http://localhost:61816\" // webuploader.authorization = \"GMyFTVCKRstZ0doyTQYVMTW6hprHTgRvjAIAiGATzaAsDLmj5_VO6isChVhTo6WaHKTS0fieCTINh6LYOD0KM2HFXMhns3JaFbUfXzZKWtqpxSxEYY6pk5J59CGjLxnl1QGxIhEvWCWd8fQ4gS5Zu3h5vQXZqi6wBt6GY7Yi15qr9ddV5-ynukLUYp2qqxs0p7CVeQgMAGk-ueBAi75sJhqHXWMR4KWzRzTj-r7o3f6KaWO5tpJTwlKl32zDwkp6mfKDtv9w9qP0b8IuTnJ-n0ABRua_6rdP9ngo_Jg--Ai7n-H2aChR4eaJRgLPdMAHk9OI7tIRY4pf1KkABqnrAylKRDUNiCotEOAwtlAZHwF6TZCd66L3QDyWiTkxRLY1brpofVsqoqKcqf_sMqlMJ1litLtTj47l66KKEcFWTlUPGwWNX7R7GFnL_f_4ugNmgrBoApUEWIlkVATtWMeX2F6wQYJIDhxoJ9tYgTBmZnXbBNLmRJud1qhqNafBG-UyAdflUVSy5He6wf6uiUxSKQ\" var serviceUrl = \"\"; webuploader.authorization = \"\"; var userInfo = { md5: '', index: '', fileToken:'' }, uploaders = {}; // 大文件分片，断点续传，以及秒传功能 // 在文件开始发送前做些异步操作。做md5验证 // WebUploader会等待此异步操作完成后，开始发送文件。 WebUploader.Uploader.register({ \"before-send-file\": \"beforeSendFile\" }, { beforeSendFile: function (file) { var task = new $.Deferred(); var $fileId = file.id; uploaders[userInfo.index].md5File(file, 0, 10 * 1024 * 1024).progress(function (percentage) { var uploadflieElement = $('#' + fileId); if (opts.uploadType === 'file') { var value = Math.round(percentage * 100); uploadflieElement.find('div.webuploadstate .webupload-text').html('正在上传' + value + '%'); } }).then(function (val) { var $fileId = file.id; userInfo.md5 = val; $.ajax({ headers: { \"Authorization\": \"Bearer \" + webuploader.authorization }, type: \"POST\", url: serviceUrl + '/File/Md5Validate', data: { md5: val, fileName: file.name }, cache: false, timeout: 3000, dataType: \"json\" }).then(function (response, textStatus, jqXHR) { //若存在，这返回失败给WebUploader，(后台操作)表明该文件不需要上传，然后就可以把数据库查询出的文件信息的物理路径给新文件 if (response.success == true) { //task.reject('秒传成功'); 此处会执行uploadError uploaders[userInfo.index].skipFile(file); userInfo.fileToken = response.result; //上传成功事件 if (uploaders[userInfo.index].options.uploadType === 'file') { if ($('#' + $fileId + ' .webuploadstate .file-token').attr('data-filetoken') != '') { return; } var limit = webuploader.bytesToSize(file.size); var downUrl = serviceUrl + '/File/Download?fileToken=' + response.result + '&amp;newName=' + file.name; $('#' + $fileId).find('div.webuploadstate .webupload-text').html(limit + ' 秒传'); $('#' + $fileId).find('div.webuploadstate .file-token').attr('data-filetoken', response.result); $('#' + $fileId) .find('div.webuploadinfo .webupload-button a') .after('&lt;a href=\"' + downUrl + '\" target=\"_blank\"&gt;&lt;span class=\"webupload-download\"&gt;下载&lt;/span&gt;&lt;/a&gt;'); } else { window.setTimeout(function () { $('#' + $fileId + ' img').attr('src', serviceUrl + '/File/Download?fileToken=' + response.result); $('#' + $fileId + ' .webupload-list-img-cover .img-upload-state span.file-token').attr('data-filetoken', response.result); }, 500); } } task.resolve(); }, function (jqXHR, textStatus, errorThrown) { //任何形式的验证失败，都触发重新上传 task.resolve(); }); }); return $.when(task); } }); function initWebUpload(item, options) { if (!WebUploader.Uploader.support()) { var error = \"上传控件不支持您的浏览器！请尝试升级flash版本或者使用Chrome引擎的浏览器。&lt;a target='_blank' href='http://se.360.cn'&gt;下载页面&lt;/a&gt;\"; if (window.console) { window.console.log(error); } $(item).text(error); return; } //创建默认参数 var defaults = { auto: true, onAllComplete: function (event) {}, // 当所有file都上传后执行的回调函数 onComplete: function (event) {}, // 每上传一个file的回调函数 innerOptions: {}, fileNumLimit: 20, //验证文件总数量, 超出则不允许加入队列 fileSizeLimit: 100 * 1024 * 1024, //验证文件总大小是否超出限制, 超出则不允许加入队列。 uploadType: 'file' //file、img }; var opts = $.extend(defaults, options); if (opts.uploadType === 'img') { opts.accept = { title: 'Images', extensions: 'gif,jpg,jpeg,bmp,png', mimeTypes: 'image/*' }; } var target = $(item); var pickerid = webuploader.GUID(); var uploaderStrdiv = '&lt;div class=\"webuploader\"&gt;'; target.attr('data-uploadType', opts.uploadType); var text = opts.uploadType === 'img' ? \"选择图片\" : \"选择文件\"; if (opts.auto) { uploaderStrdiv = '&lt;div class=\"btns\"&gt;' + '&lt;div id=\"' + pickerid + '\"&gt;' + text + '&lt;/div&gt;' + '&lt;/div&gt;' + '&lt;div class=\"uploader-list\"&gt;&lt;/div&gt;'; } else { uploaderStrdiv = '&lt;div class=\"btns\"&gt;' + '&lt;div id=\"' + pickerid + '\"&gt;' + text + '&lt;/div&gt;' + '&lt;button class=\"webuploadbtn\" type=\"button\"&gt;开始上传&lt;/button&gt;' + '&lt;/div&gt;' + '&lt;div class=\"uploader-list\"&gt;&lt;/div&gt;'; } target.append(uploaderStrdiv); var $list = target.find('.uploader-list'), $btn = target.find('.webuploadbtn'), //手动上传按钮备用 state = 'pending', uploader; var webuploaderoptions = $.extend({ // swf文件路径 swf: applicationPath + '/Uploader.swf', // 文件接收服务端。 server: serviceUrl + '/File/UploadFile', deleteServer: serviceUrl + '/File/Delete', md5Server: serviceUrl + '/File/Md5Validate', // 选择文件的按钮。可选。 // 内部根据当前运行是创建，可能是input元素，也可能是flash. pick: '#' + pickerid, //不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！ resize: false, fileNumLimit: opts.fileNumLimit, fileSizeLimit: opts.fileSizeLimit, fileSingleSizeLimit: opts.fileSingleSizeLimit, accept: opts.accept, withCredentials: true }, opts.innerOptions); uploader = WebUploader.create(webuploaderoptions); uploaders[pickerid] = uploader; $.extend(uploaders[pickerid].options, opts); uploader.on('fileQueued', function (file) { var subName = file.name; //主要解决名字太长，上传文件名会超出换行，导致样式问题，让字数在20个字符以内即可 if (subName.lastIndexOf('.') &gt; 20) { subName = subName.substring(0, 20); } else { subName = subName.substring(0, subName.lastIndexOf('.')); } subName += '.' + file.ext; var fileId = file.id; var fileUpload = \"\"; if (opts.uploadType === 'file') { fileUpload = '&lt;div id=\"' + fileId + '\" class=\"item\"&gt;\\ &lt;div class=\"nui-ico nui-ico-file32 nui-ico-file32-' + file.ext.toLowerCase() + '\"&gt;&lt;/div&gt;\\ &lt;div class=\"webuploadinfo\"&gt; &lt;span title=\"' + file.name + '\"&gt;' + subName + '&lt;/span&gt;\\ &lt;div class=\"webupload-button\"&gt;&lt;a&gt;&lt;span class=\"webupload-delete\" data-id=\"' + fileId + '\"&gt;删除&lt;/span&gt;&lt;/a&gt;&lt;/div&gt;\\ &lt;/div&gt;\\ &lt;div class=\"webuploadstate\"&gt;&lt;span class=\"file-token\" data-filetoken=\"\"&gt;&lt;/span&gt;&lt;span class=\"webupload-text\"&gt;等待上传&lt;/span&gt;\\ &lt;div id=\"progress-' + fileId + '\" class=\"progressbar-animation\"&gt;&lt;/div&gt;\\ &lt;/div&gt;\\ &lt;/div&gt;'; } else { /*/Content/images/default-profile-picture.png*/ fileUpload = '&lt;div id=\"' + fileId + '\" class=\"webupload-list-img\"&gt;\\ &lt;img src = \"\" &gt;\\ &lt;div class=\"webupload-list-img-cover\"&gt;\\ &lt;i class=\"fa fa-eye img-show\" title=\"预览\" data-id=\"' + fileId + '\"&gt;&lt;/i&gt;\\ &lt;i class=\"fa fa-remove img-delete\" title=\"删除\" data-id=\"' + fileId + '\"&gt;&lt;/i&gt;\\ &lt;div class=\"img-upload-state\" style=\"display:none;\" &gt;' + '&lt;span class=\"file-name\" data-filename=\"' + file.name + '\"&gt;&lt;/span&gt;' + '&lt;span class=\"file-token\" data-filetoken=\"\"&gt;&lt;/span&gt;' + '&lt;/div&gt;\\ &lt;/div&gt;\\ &lt;/div&gt;'; } $list.append(fileUpload); //自动上传 if (opts.auto) { uploader.upload(); } }); /* * 验证文件格式以及文件大小 */ uploader.on(\"error\", function (type) { var limit = 0; if (type === \"Q_TYPE_DENIED\") { abp.message.warn(\"不支持您上传的文件格式!\"); } else if (type === \"F_EXCEED_SIZE\") { limit = opts.fileSingleSizeLimit / 1024 / 1024; abp.message.warn(\"单个文件大小不能超过\" + limit + \"MB\"); } else if (type === \"Q_EXCEED_SIZE_LIMIT\") { limit = opts.fileSingleSizeLimit / 1024 / 1024; abp.message.warn(\"添加的文件总大小超出\" + limit + \"MB\"); } else if (type === \"Q_EXCEED_NUM_LIMIT\") { abp.message.warn(\"添加的文件数量超出范围\"); } else if (type === \"F_DUPLICATE\") { abp.message.warn(\"该文件已存在,请勿重复添加!\"); } else { abp.message.warn(\"未知类型错误:\" + type); } }); /*当文件被加入队列之前触发，此事件的handler返回值为false，则此文件不会被添加进入队列。*/ uploader.on(\"beforeFileQueued\", function (file) { if (opts.fileNumLimit == undefined) { return true; } var length; if (opts.uploadType === 'file') { //当有文件限制，在编辑时验证文件数量 length = target.find('.item').length; } else { length = target.find('.webupload-list-img').length; } if (length &gt;= opts.fileNumLimit) { abp.message.warn('添加的文件数量超出范围!'); return false; } userInfo.index = pickerid; return true; }); uploader.on('uploadProgress', function (file, percentage) { //进度条事件 var fileId = file.id; var uploadflieElement = target.find('#' + fileId); if (opts.uploadType === 'file') { var value = Math.round(percentage * 100); uploadflieElement.find('div.webuploadstate .webupload-text').html('正在上传' + value + '%'); if ($.fn.progressbar != undefined) { var $progressElement = uploadflieElement.find('div.webuploadstate #progress-' + fileId); if ($progressElement.hasClass('progressbar')) { $progressElement.progressbar('setValue', value); } else { $progressElement.progressbar({ value: value, text: '', height: 6 }); } } } else { } }); uploader.on('uploadSuccess', function (file, response) { if (response == undefined) { opts.uploadSuccess &amp;&amp; opts.uploadSuccess(file,userInfo.fileToken); return; }; //上传成功事件 //后台保存文件属性信息services 重构，后台上传文件的时候，就把数据存到后台 var $fileId = file.id; if (opts.uploadType === 'file') { if (response.success === false) { abp.message.error(response.error.message); target.find('#' + $fileId).find('div.webuploadstate .webupload-text').html(response.error.message).css('color', 'red'); } else { var limit = webuploader.bytesToSize(file.size); var downUrl = serviceUrl + '/File/Download?fileToken=' + response.result + '&amp;newName=' + file.name; target.find('#' + $fileId).find('div.webuploadstate .webupload-text').html(limit + ' 上传成功'); target.find('#' + $fileId).find('div.webuploadstate .file-token').attr('data-filetoken', response.result); target.find('#' + $fileId).find('div.webuploadinfo .webupload-button a') .after('&lt;a href=\"' + downUrl + '\" target=\"_blank\"&gt;&lt;span class=\"webupload-download\"&gt;下载&lt;/span&gt;&lt;/a&gt;'); } } else { if (response.success === false) { target.find('#' + $fileId); abp.message.error(response.error.message); } else { window.setTimeout(function () { target.find('#' + $fileId + ' img').attr('src', serviceUrl + '/File/Download?fileToken=' + response.result); target.find('#' + $fileId + ' .webupload-list-img-cover .img-upload-state span.file-token').attr('data-filetoken', response.result); }, 500); } } opts.uploadSuccess &amp;&amp; opts.uploadSuccess(file, response.result); }); uploader.on('uploadError', function (file, reason) { if (reason == undefined) target.find('#' + file.id).find('div.webuploadstate .webupload-text').html(reason); }); uploader.on('uploadComplete', function (file) { //全部完成事件 var fileId = file.id; target.find('#' + fileId).find('#progress-' + fileId).fadeOut(); }); uploader.on('all', function (type) { if (type === 'startUpload') { state = 'uploading'; } else if (type === 'stopUpload') { state = 'paused'; } else if (type === 'uploadFinished') { state = 'done'; } if (state === 'uploading') { $btn.text('暂停上传'); } else { $btn.text('开始上传'); } }); var deleteFile = function (fileToken, callback) { //callback &amp;&amp; callback(); // 增加秒传后，不再执行删除后台数据及文件操作 //2018-10-17 后台接口调整，文件md5验证和token关联存储 if (!webuploader.isNullOrEmpty(fileToken)) { abp.ajax({ url:webuploaderoptions.deleteServer, data:JSON.stringify({ fileToken:fileToken }), headers:{ \"Authorization\": \"Bearer \" + webuploader.authorization }, success:function(data){ if (data.Succeed == 0 &amp;&amp; data.Message == \"该文件不存在!\") { abp.message.warn(data.Message); callback &amp;&amp; callback(); return; } if (data.Succeed == 0) { abp.message.warn(data.Message); } else { callback &amp;&amp; callback(); } } }); } else { callback &amp;&amp; callback(); } } //删除时执行的方法 uploader.on('fileDequeued', function (file) { var fileToken; var fileId = file.id; if (target.data('uploadtype') === 'file') { fileToken = target.find(\"#\" + fileId + ' .webuploadstate .file-token').data('filetoken'); } else { fileToken = target.find('#' + fileId + ' .webupload-list-img-cover .img-upload-state span.file-token').attr('data-filetoken'); } debugger deleteFile(fileToken, function () { target.find(\"#\" + fileId).hide(500, function () { $(this).remove(); }); }); }); uploader.on('uploadBeforeSend', function (object, data, headers) { $.extend(headers, { \"Authorization\": \"Bearer \" + webuploader.authorization }); $.extend(data, { md5: userInfo.md5, __RequestVerificationToken: $('form input[name=__RequestVerificationToken]').val() }); }); //多文件点击上传的方法 $btn.on('click', function () { if (state === 'uploading') { uploader.stop(); } else { uploader.upload(); } }); //删除 if (opts.uploadType === 'file') { $list.on(\"click\", \".webupload-delete\", function () { var $ele = $(this); var fileId = $ele.attr(\"data-id\"); var file = uploader.getFile(fileId); if (file == undefined) { //前台直接删除 $('#' + fileId).fadeOut(500, function () { $(this).remove(); }); var list = fileId.split('_'); var fileToken = $(\"#hiddenInput\" + list[list.length - 1]).val(); if (list.length &gt;= 1) { $(\"#hiddenInput\" + list[list.length - 1]).remove(); } } else { uploader.removeFile(file); } }); } else { $list.on(\"click\", \".img-delete\", function () { var $ele = $(this); var fileId = $ele.attr(\"data-id\"); var file = uploader.getFile(fileId); if (file == undefined) { //前台直接删除 var filetoken = $ele.next().find('.file-token').data('filetoken'); deleteFile(filetoken, function () { $('#' + fileId).hide(500, function () { $(this).remove(); }); }); } else { uploader.removeFile(file); } }); $list.on(\"click\", \".img-show\", function () { var $ele = $(this); webuploader.imagePreviewDialog($ele); }); } return uploader; } $.extend(webuploader, { /** * webuploader的图片预览效果 * @param {} $ele 当前点击的图片elem */ imagePreviewDialog: function ($ele) { var id = '#' + $ele.attr(\"data-id\"); var imgSrc = $(id).find('img').attr('src'); abp.imagePreviewDialog(imgSrc); }, /** * 动态加载webuploader控件 * @param {any} callback */ getWebUpload: function (callback) { if (typeof WebUploader == 'undefined') { var casspath = applicationPath + \"/webuploader.css\"; $(\"&lt;link&gt;\").attr({ rel: \"stylesheet\", type: \"text/css\", href: casspath }).appendTo(\"head\"); var jspath = applicationPath + \"/webuploader.min.js\"; $.getScript(jspath).done(function () { callback &amp;&amp; callback(); }).fail(function () { abp.message.warn(\"请检查webuploader的路径是否正确!\"); }); } else { callback &amp;&amp; callback(); } }, /** * 上传文件模板 * @param {boolean} isCheck 是否是查看界面 true/false * @returns {} 参数为空时，默认不是查看界面，有删除按钮。参数为true时，无删除按钮 */ template: function (isCheck) { //如果是查看，没有删除按钮 var template = '&lt;div id=\"BinduploadflieWU_FILE_{0}\" class=\"item\"&gt;' + '&lt;div class=\"nui-ico nui-ico-file32 nui-ico-file32-{1}\"&gt;&lt;/div&gt;' + '&lt;div class=\"webuploadinfo\"&gt;' + '&lt;span title=\"{2}\"&gt;{3}&lt;/span&gt;' + '&lt;div class=\"webupload-button\"&gt;'; if (!isCheck) { template += '&lt;a&gt;&lt;span class=\"webupload-delete\" data-id=\"BinduploadflieWU_FILE_{0}\"&gt;删除&lt;/span&gt;&lt;/a&gt;'; } template += '&lt;a href=\"' + serviceUrl + '/File/Download?fileToken={4}&amp;newName={2}\" target=\"_blank\"&gt;&lt;span class=\"webupload-download\"&gt;下载&lt;/span&gt;&lt;/a&gt;' + '&lt;/div&gt;' + '&lt;div class=\"webuploadstate\"&gt;&lt;span class=\"file-token\" data-filetoken=\"{4}\"&gt;&lt;/span&gt;&lt;span class=\"webupload-text\"&gt;{5}&lt;/span&gt;&lt;/div&gt;' + '&lt;/div&gt;&lt;/div&gt;'; return template; }, /** * 图片上传模板 * @param {} isCheck 是否是查看界面 true/false * @returns {} 参数为空时，默认不是查看界面，有删除功能。参数为true时，无删除功能 */ templateImg: function (isCheck) { var template = '&lt;div id=\"BinduploadflieWU_FILE_{0}\" class=\"webupload-list-img\"&gt;' + '&lt;img src=\"' + serviceUrl + '/File/Download?fileToken={2}\"&gt;' + '&lt;div class=\"webupload-list-img-cover\"&gt;' + '&lt;i class=\"fa fa-eye img-show\" title=\"预览\" data-id=\"BinduploadflieWU_FILE_{0}\"&gt;&lt;/i&gt;'; if (!isCheck) { template += '&lt;i class=\"fa fa-remove img-delete\" title=\"删除\" data-id=\"BinduploadflieWU_FILE_{0}\"&gt;&lt;/i&gt;'; } template += '&lt;div class=\"img-upload-state\" style=\"display:none;\"&gt;&lt;span class=\"file-name\" data-filename=\"{1}\"&gt;&lt;/span&gt;&lt;span class=\"file-token\" data-filetoken=\"{2}\"&gt;&lt;/span&gt;&lt;/div&gt;' + '&lt;/div&gt;' + '&lt;/div&gt;'; return template; }, /** * 当图片没有时，会显示404图片 * @param {} img * @returns {} */ show404: function (img) { img.src = applicationPath + \"/images/404.png\"; img.onerror = null; }, /** * 编辑时，加载上传控件 * @param {Object&lt;&gt;} options * 参数 | 默认值 | 说明 * { * elem '#upload-file' 上传控件id * rows [] * isCheck false 是否为查看 true/false * uploadeFile 'file' 上传类型：'file' / 'img' * }参数: */ loadFile: function (options) { var defaults = { elem: '#upload-files', rows: [], isCheck: false, //是否为查看 uploadType: 'file' //绑定文件类型 file 或 img }; options = $.extend(defaults, options); var rows = webuploader.getFiles(options.elem); if (rows &amp;&amp; rows.length === 0) { rows = options.rows; } if (rows &amp;&amp; rows.length &gt; 0) { webuploader.getWebUpload(function () { //未找到webuploader的控件加载成功后的回调事件，采用setTimeout()延迟执行 setTimeout(function () { var html = ''; var uploadType = $(options.elem).data('uploadtype'); if (options.isCheck === true) { html += '&lt;div class=\"uploader-list\"&gt;'; uploadType = options.uploadType; } $.each(rows, function (i, v) { var subName = v.FileName; if (subName.lastIndexOf('.') &gt; 20) { subName = subName.substring(0, 20); } else { subName = subName.substring(0, subName.lastIndexOf('.')); } var d = v.FileName; var ext = d.substr(d.lastIndexOf('.') + 1, d.length); subName += '.' + ext; var limit = webuploader.bytesToSize(v.FileSize); if (uploadType === 'file') { //参数（id,文件后缀，文件名，截取后的文件名，fileToken,上传状态（文件大小+上传成功）) html += webuploader.format(webuploader.template(options.isCheck), v.Id, ext.toLowerCase(), v.FileName, subName, v.FileToken, limit + \"上传成功\"); } else { html += webuploader.format(webuploader.templateImg(options.isCheck), v.Id, v.FileName, v.FileToken); } }); if (options.isCheck === true) { html += '&lt;/div&gt;'; $(options.elem).append(html); $(options.elem).find('.img-show').on('click', function () { var $ele = $(this); webuploader.imagePreviewDialog($ele); }); } else { $(options.elem + ' div.uploader-list').append(html); } }, 400); }); } }, //&lt;ul style=\"display:none;\" id=\"abpfiles\" &gt; //@foreach(var item in Model.AbpFileOutput) //{ // &lt;li data-filetoken=\"@item.FileToken\" data-id=\"@item.Id\" data-filesize=\"@item.FileSize\"&gt;@item.FileName&lt;/li&gt; //} //&lt;/ul&gt; //上面的格式，会得到当前已上传的文件数组 getFiles: function (elemId) { var abpfiles = []; $.each($(elemId + ' ul li'), function (i, v) { abpfiles.push({ Id: $(v).attr('data-id'), FileToken: $(v).attr('data-filetoken'), FileSize: $(v).attr('data-filesize'), FileName: $(v).text() }); }); return abpfiles; }, /** * 格式化字符串 * @param {string} \"{0}-{1}\",\"a\",\"b\" * @returns a-b * @example 用法: webuploader.format(\"{0}-{1}\",\"a\",\"b\"); */ format: function () { for (var i = 1; i &lt; arguments.length; i++) { var exp = new RegExp('\\\\{' + (i - 1) + '\\\\}', 'gm'); arguments[0] = arguments[0].replace(exp, arguments[i]); } return arguments[0]; }, /** * 判断变量是否为null或空 * @example 用法: * webuploader.isNullOrEmpty(null) */ isNullOrEmpty: function (str) { return str === undefined || str === null || str === \"\"; }, /** * 生成一个guid数据 */ GUID: function () { return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1); }, /** * 1024MB转换成1GB * @param {number} bytes * @returns {} 返回最小不可转换的单位的空间大小 */ bytesToSize: function (bytes) { if (bytes === undefined || bytes === null || bytes === \"\") return \"\"; if (bytes == 0) return '0B'; var k = 1024; var sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']; var i = Math.floor(Math.log(bytes) / Math.log(k)); return (bytes / Math.pow(k, i)).toPrecision(3) + sizes[i]; } }); /** * 扩展方法：得到当前控件已经上传成功的文件地址，多文件，中间以*分割 */ $.fn.GetFilesAddress = function () { var filesAddress = []; if ($(this).data('uploadtype') === 'file') { $(this).find(\".uploader-list .webuploadstate .file-token\").each(function () { filesAddress.push($(this).data('filetoken')); }); } else { $(this).find('.uploader-list .webupload-list-img .webupload-list-img-cover .img-upload-state span.file-token').each(function () { filesAddress.push($(this).data('filetoken')); }); } return filesAddress.join('*'); } /** * 扩展方法：初始化上传文件 * @param {Object&lt;&gt;} 参数为webuploader插件的所有参数 * @param 新增参数:uploadType:'file'或'img' 上传类型：file为文件;img为图片，有上传预览效果 */ $.fn.powerWebUpload = function (options) { var ele = this; webuploader.getWebUpload(function () { initWebUpload(ele, options); options &amp;&amp; options.callback &amp;&amp; options.callback(); }); } })(jQuery, window); × Search results Close "},"libs_abp.js.html":{"id":"libs_abp.js.html","title":"Source: libs/abp.js","body":" Common Modules Global acceptauthorizeButtonbaseUrlbtnImportbytesToSizechangeCodeclearclearByIdcloseCurrentTabconfigdeleteallrowsdeletededitEditGridViewModelEditTreeGridViewModelexportExcelexportWordformatformatMsgformatYesgetSelectIdgetWebUploadGUIDIEVersionignoreEleimagePreviewDialogisNullOrEmptylinesloadFileopacityopenPostWindowpdfModalpromptscrollTosearchsetBusyshow404showChildrenspinstoptemplatetemplateImgtoTreeDatauuidwebuploader Source: libs/abp.js var abp = abp || {}; (function ($) { /* Application paths *****************************************/ //Current application root path (including virtual directory if exists). abp.appPath = abp.appPath || '/'; abp.pageLoadTime = new Date(); //Converts given path to absolute path using abp.appPath variable. abp.toAbsAppPath = function (path) { if (path.indexOf('/') == 0) { path = path.substring(1); } return abp.appPath + path; }; /* MULTITENANCY */ abp.multiTenancy = abp.multiTenancy || {}; abp.multiTenancy.isEnabled = false; abp.multiTenancy.sides = { TENANT: 1, HOST: 2 }; abp.multiTenancy.tenantIdCookieName = 'Abp.TenantId'; abp.multiTenancy.setTenantIdCookie = function (tenantId) { if (tenantId) { abp.utils.setCookieValue( abp.multiTenancy.tenantIdCookieName, tenantId.toString(), new Date(new Date().getTime() + 5 * 365 * 86400000), //5 years abp.appPath, abp.domain ); } else { abp.utils.deleteCookie(abp.multiTenancy.tenantIdCookieName, abp.appPath); } }; abp.multiTenancy.getTenantIdCookie = function () { var value = abp.utils.getCookieValue(abp.multiTenancy.tenantIdCookieName); if (!value) { return null; } return parseInt(value); } /* SESSION */ abp.session = abp.session || { multiTenancySide: abp.multiTenancy.sides.HOST }; /* LOCALIZATION ***********************************************/ //Implements Localization API that simplifies usage of localization scripts generated by Abp. abp.localization = abp.localization || {}; abp.localization.languages = []; abp.localization.currentLanguage = {}; abp.localization.sources = []; abp.localization.values = {}; abp.localization.localize = function (key, sourceName) { sourceName = sourceName || abp.localization.defaultSourceName; var source = abp.localization.values[sourceName]; if (!source) { abp.log.warn('Could not find localization source: ' + sourceName); return key; } var value = source[key]; if (value == undefined) { return key; } var copiedArguments = Array.prototype.slice.call(arguments, 0); copiedArguments.splice(1, 1); copiedArguments[0] = value; return abp.utils.formatString.apply(this, copiedArguments); }; abp.localization.getSource = function (sourceName) { return function (key) { var copiedArguments = Array.prototype.slice.call(arguments, 0); copiedArguments.splice(1, 0, sourceName); return abp.localization.localize.apply(this, copiedArguments); }; }; abp.localization.isCurrentCulture = function (name) { return abp.localization.currentCulture &amp;&amp; abp.localization.currentCulture.name &amp;&amp; abp.localization.currentCulture.name.indexOf(name) == 0; }; abp.localization.defaultSourceName = undefined; abp.localization.abpWeb = abp.localization.getSource('AbpWeb'); /* AUTHORIZATION **********************************************/ //Implements Authorization API that simplifies usage of authorization scripts generated by Abp. abp.auth = abp.auth || {}; abp.auth.allPermissions = abp.auth.allPermissions || {}; abp.auth.grantedPermissions = abp.auth.grantedPermissions || {}; //Deprecated. Use abp.auth.isGranted instead. abp.auth.hasPermission = function (permissionName) { return abp.auth.isGranted.apply(this, arguments); }; //Deprecated. Use abp.auth.isAnyGranted instead. abp.auth.hasAnyOfPermissions = function () { return abp.auth.isAnyGranted.apply(this, arguments); }; //Deprecated. Use abp.auth.areAllGranted instead. abp.auth.hasAllOfPermissions = function () { return abp.auth.areAllGranted.apply(this, arguments); }; abp.auth.isGranted = function (permissionName) { return abp.auth.allPermissions[permissionName] != undefined &amp;&amp; abp.auth.grantedPermissions[permissionName] != undefined; }; abp.auth.isAnyGranted = function () { if (!arguments || arguments.length &lt;= 0) { return true; } for (var i = 0; i &lt; arguments.length; i++) { if (abp.auth.isGranted(arguments[i])) { return true; } } return false; }; abp.auth.areAllGranted = function () { if (!arguments || arguments.length &lt;= 0) { return true; } for (var i = 0; i &lt; arguments.length; i++) { if (!abp.auth.isGranted(arguments[i])) { return false; } } return true; }; abp.auth.tokenCookieName = 'Abp.AuthToken.'+abp.projectName; abp.auth.setToken = function (authToken, expireDate) { abp.utils.setCookieValue(abp.auth.tokenCookieName, authToken, expireDate, abp.appPath, abp.domain); }; abp.auth.getToken = function () { return abp.utils.getCookieValue(abp.auth.tokenCookieName); } abp.auth.clearToken = function () { abp.auth.setToken(); } /* FEATURE SYSTEM *********************************************/ //Implements Features API that simplifies usage of feature scripts generated by Abp. abp.features = abp.features || {}; abp.features.allFeatures = abp.features.allFeatures || {}; abp.features.get = function (name) { return abp.features.allFeatures[name]; } abp.features.getValue = function (name) { var feature = abp.features.get(name); if (feature == undefined) { return undefined; } return feature.value; } abp.features.isEnabled = function (name) { var value = abp.features.getValue(name); return value == 'true' || value == 'True'; } /* SETTINGS **************************************************/ //Implements Settings API that simplifies usage of setting scripts generated by Abp. abp.setting = abp.setting || {}; abp.setting.values = abp.setting.values || {}; abp.setting.get = function (name) { return abp.setting.values[name]; }; abp.setting.getBoolean = function (name) { var value = abp.setting.get(name); return value == 'true' || value == 'True'; }; abp.setting.getInt = function (name) { return parseInt(abp.setting.values[name]); }; /* REALTIME NOTIFICATIONS ************************************/ abp.notifications = abp.notifications || {}; abp.notifications.severity = { INFO: 0, SUCCESS: 1, WARN: 2, ERROR: 3, FATAL: 4 }; abp.notifications.userNotificationState = { UNREAD: 0, READ: 1 }; abp.notifications.getUserNotificationStateAsString = function (userNotificationState) { switch (userNotificationState) { case abp.notifications.userNotificationState.READ: return 'READ'; case abp.notifications.userNotificationState.UNREAD: return 'UNREAD'; default: abp.log.warn('Unknown user notification state value: ' + userNotificationState) return '?'; } }; abp.notifications.getUiNotifyFuncBySeverity = function (severity) { switch (severity) { case abp.notifications.severity.SUCCESS: return abp.notify.success; case abp.notifications.severity.WARN: return abp.notify.warn; case abp.notifications.severity.ERROR: return abp.notify.error; case abp.notifications.severity.FATAL: return abp.notify.error; case abp.notifications.severity.INFO: default: return abp.notify.info; } }; abp.notifications.messageFormatters = {}; abp.notifications.messageFormatters['Abp.Notifications.MessageNotificationData'] = function (userNotification) { return userNotification.notification.data.message || userNotification.notification.data.properties.Message; }; abp.notifications.messageFormatters['Abp.Notifications.LocalizableMessageNotificationData'] = function (userNotification) { var message = userNotification.notification.data.message || userNotification.notification.data.properties.Message; var localizedMessage = abp.localization.localize( message.name, message.sourceName ); if (userNotification.notification.data.properties) { if ($) { //Prefer to use jQuery if possible $.each(userNotification.notification.data.properties, function (key, value) { localizedMessage = localizedMessage.replace('{' + key + '}', value); }); } else { //alternative for $.each var properties = Object.keys(userNotification.notification.data.properties); for (var i = 0; i &lt; properties.length; i++) { localizedMessage = localizedMessage.replace('{' + properties[i] + '}', userNotification.notification.data.properties[properties[i]]); } } } return localizedMessage; }; abp.notifications.getFormattedMessageFromUserNotification = function (userNotification) { var formatter = abp.notifications.messageFormatters[userNotification.notification.data.type]; if (!formatter) { abp.log.warn('No message formatter defined for given data type: ' + userNotification.notification.data.type) return '?'; } if (!abp.utils.isFunction(formatter)) { abp.log.warn('Message formatter should be a function! It is invalid for data type: ' + userNotification.notification.data.type) return '?'; } return formatter(userNotification); } abp.notifications.showUiNotifyForUserNotification = function (userNotification, options) { var message = abp.notifications.getFormattedMessageFromUserNotification(userNotification); var uiNotifyFunc = abp.notifications.getUiNotifyFuncBySeverity(userNotification.notification.severity); uiNotifyFunc(message, undefined, options); } /* LOGGING ***************************************************/ //Implements Logging API that provides secure &amp; controlled usage of console.log abp.log = abp.log || {}; abp.log.levels = { DEBUG: 1, INFO: 2, WARN: 3, ERROR: 4, FATAL: 5 }; abp.log.level = abp.log.levels.DEBUG; abp.log.log = function (logObject, logLevel) { if (!window.console || !window.console.log) { return; } if (logLevel != undefined &amp;&amp; logLevel &lt; abp.log.level) { return; } }; abp.log.debug = function (logObject) { abp.log.log(\"DEBUG: \", abp.log.levels.DEBUG); abp.log.log(logObject, abp.log.levels.DEBUG); }; abp.log.info = function (logObject) { abp.log.log(\"INFO: \", abp.log.levels.INFO); abp.log.log(logObject, abp.log.levels.INFO); }; abp.log.warn = function (logObject) { abp.log.log(\"WARN: \", abp.log.levels.WARN); abp.log.log(logObject, abp.log.levels.WARN); }; abp.log.error = function (logObject) { abp.log.log(\"ERROR: \", abp.log.levels.ERROR); abp.log.log(logObject, abp.log.levels.ERROR); }; abp.log.fatal = function (logObject) { abp.log.log(\"FATAL: \", abp.log.levels.FATAL); abp.log.log(logObject, abp.log.levels.FATAL); }; /* NOTIFICATION *********************************************/ //Defines Notification API, not implements it abp.notify = abp.notify || {}; abp.notify.success = function (message, title, options) { abp.log.warn('abp.notify.success is not implemented!'); }; abp.notify.info = function (message, title, options) { abp.log.warn('abp.notify.info is not implemented!'); }; abp.notify.warn = function (message, title, options) { abp.log.warn('abp.notify.warn is not implemented!'); }; abp.notify.error = function (message, title, options) { abp.log.warn('abp.notify.error is not implemented!'); }; /* MESSAGE **************************************************/ //Defines Message API, not implements it abp.message = abp.message || {}; var showMessage = function (message, title) { alert((title || '') + ' ' + message); if (!$) { abp.log.warn('abp.message can not return promise since jQuery is not defined!'); return null; } return $.Deferred(function ($dfd) { $dfd.resolve(); }); }; abp.message.info = function (message, title) { abp.log.warn('abp.message.info is not implemented!'); return showMessage(message, title); }; abp.message.success = function (message, title) { abp.log.warn('abp.message.success is not implemented!'); return showMessage(message, title); }; abp.message.warn = function (message, title) { abp.log.warn('abp.message.warn is not implemented!'); return showMessage(message, title); }; abp.message.error = function (message, title) { abp.log.warn('abp.message.error is not implemented!'); return showMessage(message, title); }; abp.message.confirm = function (message, titleOrCallback, callback) { abp.log.warn('abp.message.confirm is not implemented!'); if (titleOrCallback &amp;&amp; !(typeof titleOrCallback == 'string')) { callback = titleOrCallback; } var result = confirm(message); callback &amp;&amp; callback(result); if (!$) { abp.log.warn('abp.message can not return promise since jQuery is not defined!'); return null; } return $.Deferred(function ($dfd) { $dfd.resolve(); }); }; /* UI *******************************************************/ abp.ui = abp.ui || {}; /* UI BLOCK */ //Defines UI Block API, not implements it abp.ui.block = function (elm) { abp.log.warn('abp.ui.block is not implemented!'); }; abp.ui.unblock = function (elm) { abp.log.warn('abp.ui.unblock is not implemented!'); }; /* UI BUSY */ //Defines UI Busy API, not implements it abp.ui.setBusy = function (elm, optionsOrPromise) { abp.log.warn('abp.ui.setBusy is not implemented!'); }; abp.ui.clearBusy = function (elm) { abp.log.warn('abp.ui.clearBusy is not implemented!'); }; /* SIMPLE EVENT BUS *****************************************/ abp.event = (function () { var _callbacks = {}; var on = function (eventName, callback) { if (!_callbacks[eventName]) { _callbacks[eventName] = []; } _callbacks[eventName].push(callback); }; var off = function (eventName, callback) { var callbacks = _callbacks[eventName]; if (!callbacks) { return; } var index = -1; for (var i = 0; i &lt; callbacks.length; i++) { if (callbacks[i] === callback) { index = i; break; } } if (index &lt; 0) { return; } _callbacks[eventName].splice(index, 1); }; var trigger = function (eventName) { var callbacks = _callbacks[eventName]; if (!callbacks || !callbacks.length) { return; } var args = Array.prototype.slice.call(arguments, 1); for (var i = 0; i &lt; callbacks.length; i++) { callbacks[i].apply(this, args); } }; // Public interface /////////////////////////////////////////////////// return { on: on, off: off, trigger: trigger }; })(); /* UTILS ***************************************************/ abp.utils = abp.utils || {}; /* Creates a name namespace. * Example: * var taskService = abp.utils.createNamespace(abp, 'services.task'); * taskService will be equal to abp.services.task * first argument (root) must be defined first ************************************************************/ abp.utils.createNamespace = function (root, ns) { var parts = ns.split('.'); for (var i = 0; i &lt; parts.length; i++) { if (typeof root[parts[i]] == 'undefined') { root[parts[i]] = {}; } root = root[parts[i]]; } return root; }; /* Find and replaces a string (search) to another string (replacement) in * given string (str). * Example: * abp.utils.replaceAll('This is a test string', 'is', 'X') = 'ThX X a test string' ************************************************************/ abp.utils.replaceAll = function (str, search, replacement) { var fix = search.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&amp;\"); return str.replace(new RegExp(fix, 'g'), replacement); }; /* Formats a string just like string.format in C#. * Example: * abp.utils.formatString('Hello {0}','Tuana') = 'Hello Tuana' ************************************************************/ abp.utils.formatString = function () { if (arguments.length &lt; 1) { return null; } var str = arguments[0]; for (var i = 1; i &lt; arguments.length; i++) { var placeHolder = '{' + (i - 1) + '}'; str = abp.utils.replaceAll(str, placeHolder, arguments[i]); } return str; }; abp.utils.toPascalCase = function (str) { if (!str || !str.length) { return str; } if (str.length === 1) { return str.charAt(0).toUpperCase(); } return str.charAt(0).toUpperCase() + str.substr(1); } abp.utils.toCamelCase = function (str) { if (!str || !str.length) { return str; } if (str.length === 1) { return str.charAt(0).toLowerCase(); } return str.charAt(0).toLowerCase() + str.substr(1); } abp.utils.truncateString = function (str, maxLength) { if (!str || !str.length || str.length &lt;= maxLength) { return str; } return str.substr(0, maxLength); }; abp.utils.truncateStringWithPostfix = function (str, maxLength, postfix) { postfix = postfix || '...'; if (!str || !str.length || str.length &lt;= maxLength) { return str; } if (maxLength &lt;= postfix.length) { return postfix.substr(0, maxLength); } return str.substr(0, maxLength - postfix.length) + postfix; }; abp.utils.isFunction = function (obj) { if ($) { //Prefer to use jQuery if possible return $.isFunction(obj); } //alternative for $.isFunction return !!(obj &amp;&amp; obj.constructor &amp;&amp; obj.call &amp;&amp; obj.apply); }; /** * parameterInfos should be an array of { name, value } objects * where name is query string parameter name and value is it's value. * includeQuestionMark is true by default. */ abp.utils.buildQueryString = function (parameterInfos, includeQuestionMark) { if (includeQuestionMark === undefined) { includeQuestionMark = true; } var qs = ''; function addSeperator() { if (!qs.length) { if (includeQuestionMark) { qs = qs + '?'; } } else { qs = qs + '&amp;'; } } for (var i = 0; i &lt; parameterInfos.length; ++i) { var parameterInfo = parameterInfos[i]; if (parameterInfo.value === undefined) { continue; } if (parameterInfo.value === null) { parameterInfo.value = ''; } addSeperator(); if (parameterInfo.value.toJSON &amp;&amp; typeof parameterInfo.value.toJSON === \"function\") { qs = qs + parameterInfo.name + '=' + encodeURIComponent(parameterInfo.value.toJSON()); } else if (Array.isArray(parameterInfo.value) &amp;&amp; parameterInfo.value.length) { for (var j = 0; j &lt; parameterInfo.value.length; j++) { if (j &gt; 0) { addSeperator(); } qs = qs + parameterInfo.name + '[' + j + ']=' + encodeURIComponent(parameterInfo.value[j]); } } else { qs = qs + parameterInfo.name + '=' + encodeURIComponent(parameterInfo.value); } } return qs; } /** * Sets a cookie value for given key. * This is a simple implementation created to be used by ABP. * Please use a complete cookie library if you need. * @param {string} key * @param {string} value * @param {Date} expireDate (optional). If not specified the cookie will expire at the end of session. * @param {string} path (optional) */ abp.utils.setCookieValue = function (key, value, expireDate, path, domain) { var cookieValue = encodeURIComponent(key) + '='; if (value) { cookieValue = cookieValue + encodeURIComponent(value); } if (expireDate) { cookieValue = cookieValue + \"; expires=\" + expireDate.toUTCString(); } if (path) { cookieValue = cookieValue + \"; path=\" + path; } if (domain) { cookieValue = cookieValue + \"; domain=\" + domain; } document.cookie = cookieValue; }; /** * Gets a cookie with given key. * This is a simple implementation created to be used by ABP. * Please use a complete cookie library if you need. * @param {string} key * @returns {string} Cookie value or null */ abp.utils.getCookieValue = function (key) { var equalities = document.cookie.split('; '); for (var i = 0; i &lt; equalities.length; i++) { if (!equalities[i]) { continue; } var splitted = equalities[i].split('='); if (splitted.length != 2) { continue; } if (decodeURIComponent(splitted[0]) === key) { return decodeURIComponent(splitted[1] || ''); } } return null; }; /** * Deletes cookie for given key. * This is a simple implementation created to be used by ABP. * Please use a complete cookie library if you need. * @param {string} key * @param {string} path (optional) */ abp.utils.deleteCookie = function (key, path) { var cookieValue = encodeURIComponent(key) + '='; cookieValue = cookieValue + \"; expires=\" + (new Date(new Date().getTime() - 86400000)).toUTCString(); if (path) { cookieValue = cookieValue + \"; path=\" + path; } document.cookie = cookieValue; } /** * Gets the domain of given url * @param {string} url * @returns {string} */ abp.utils.getDomain = function (url) { var domainRegex = /(https?:){0,1}\\/\\/((?:[\\w\\d-]+\\.)+[\\w\\d]{2,})/i; var matches = domainRegex.exec(url); return (matches &amp;&amp; matches[2]) ? matches[2] : ''; } /* TIMING *****************************************/ abp.timing = abp.timing || {}; abp.timing.utcClockProvider = (function () { var toUtc = function (date) { return Date.UTC( date.getUTCFullYear() , date.getUTCMonth() , date.getUTCDate() , date.getUTCHours() , date.getUTCMinutes() , date.getUTCSeconds() , date.getUTCMilliseconds() ); } var now = function () { return new Date(); }; var normalize = function (date) { if (!date) { return date; } return new Date(toUtc(date)); }; // Public interface /////////////////////////////////////////////////// return { now: now, normalize: normalize, supportsMultipleTimezone: true }; })(); abp.timing.localClockProvider = (function () { var toLocal = function (date) { return new Date( date.getFullYear() , date.getMonth() , date.getDate() , date.getHours() , date.getMinutes() , date.getSeconds() , date.getMilliseconds() ); } var now = function () { return toLocal(new Date()); } var normalize = function (date) { if (!date) { return date; } return toLocal(date); } // Public interface /////////////////////////////////////////////////// return { now: now, normalize: normalize, supportsMultipleTimezone: false }; })(); abp.timing.unspecifiedClockProvider = (function () { var now = function () { return new Date(); } var normalize = function (date) { return date; } // Public interface /////////////////////////////////////////////////// return { now: now, normalize: normalize, supportsMultipleTimezone: false }; })(); abp.timing.convertToUserTimezone = function (date) { var localTime = date.getTime(); var utcTime = localTime + (date.getTimezoneOffset() * 60000); var targetTime = parseInt(utcTime) + parseInt(abp.timing.timeZoneInfo.windows.currentUtcOffsetInMilliseconds); return new Date(targetTime); }; /* CLOCK *****************************************/ abp.clock = abp.clock || {}; abp.clock.now = function () { if (abp.clock.provider) { return abp.clock.provider.now(); } return new Date(); } abp.clock.normalize = function (date) { if (abp.clock.provider) { return abp.clock.provider.normalize(date); } return date; } abp.clock.provider = abp.timing.unspecifiedClockProvider; /* SECURITY ***************************************/ abp.security = abp.security || {}; abp.security.antiForgery = abp.security.antiForgery || {}; abp.security.antiForgery.tokenCookieName = 'XSRF-TOKEN-'+abp.projectName; abp.security.antiForgery.tokenHeaderName = 'X-XSRF-TOKEN-'+abp.projectName; abp.security.antiForgery.getToken = function () { return abp.utils.getCookieValue(abp.security.antiForgery.tokenCookieName); }; abp.security.antiForgery.shouldSendToken = function (settings) { if (settings.crossDomain === undefined || settings.crossDomain === null) { return abp.utils.getDomain(location.href) === abp.utils.getDomain(settings.url); } return !settings.crossDomain; }; })(jQuery); × Search results Close "},"ProjectLib_base.js.html":{"id":"ProjectLib_base.js.html","title":"Source: ProjectLib/base.js","body":" Common Modules Global acceptauthorizeButtonbaseUrlbtnImportbytesToSizechangeCodeclearclearByIdcloseCurrentTabconfigdeleteallrowsdeletededitEditGridViewModelEditTreeGridViewModelexportExcelexportWordformatformatMsgformatYesgetSelectIdgetWebUploadGUIDIEVersionignoreEleimagePreviewDialogisNullOrEmptylinesloadFileopacityopenPostWindowpdfModalpromptscrollTosearchsetBusyshow404showChildrenspinstoptemplatetemplateImgtoTreeDatauuidwebuploader Source: ProjectLib/base.js /** * 模块名：基础脚本 * 程序名: 项目方法封装函数 **/ //属性 var com = com || {}; $.extend(com, { /** * @returns {boolean} 调试或发布状态 */ config: { isDebug: true }, /** * 服务层api访问s根地址 */ baseUrl: '/api/services/app', json: {} }); //扩展方法 $.extend(com, { /** * datagrid行内编辑封装 * @param {element} grid $('#dgGrid') * @returns {Object&lt;&gt;} 当前对象实例 */ EditGridViewModel: function (grid) { var self = this; this.begin = function (index, row) { if (index == undefined || typeof index === 'object') { row = grid.datagrid('getSelected'); index = grid.datagrid('getRowIndex', row); } self.editIndex = self.ended() ? index : self.editIndex; grid.datagrid('selectRow', self.editIndex).datagrid('beginEdit', self.editIndex); }; this.ended = function () { if (self.editIndex == undefined) return true; if (grid.datagrid('validateRow', self.editIndex)) { grid.datagrid('endEdit', self.editIndex); self.editIndex = undefined; return true; } grid.datagrid('selectRow', self.editIndex); return false; }; this.addnew = function (rowData) { if (self.ended()) { if (Object.prototype.toString.call(rowData) != '[object Object]') rowData = {}; rowData = $.extend({ _isnew: true }, rowData); grid.datagrid('appendRow', rowData); self.editIndex = grid.datagrid('getRows').length - 1; grid.datagrid('selectRow', self.editIndex); self.begin(self.editIndex, rowData); } }; this.deleterow = function () { var selectRow = grid.datagrid('getSelected'); if (selectRow) { var selectIndex = grid.datagrid('getRowIndex', selectRow); if (selectIndex == self.editIndex) { grid.datagrid('cancelEdit', self.editIndex); self.editIndex = undefined; } grid.datagrid('deleteRow', selectIndex); } }; /** * addnew 多行之后 若是出现删除bug，可在addnew 之后 调用 grid.datagrid('clearSelections'); */ this.deleteallrows = function () { var rows = grid.datagrid('getSelections'); var selectRows = rows.concat(); if (selectRows.length) { for (var i in selectRows) { if (selectRows.hasOwnProperty(i)) { var selectIndex = grid.datagrid('getRowIndex', selectRows[i]); if (selectIndex == self.editIndex) { grid.datagrid('cancelEdit', self.editIndex); self.editIndex = undefined; } grid.datagrid('deleteRow', selectIndex); } } grid.datagrid('clearSelections'); return true; } grid.datagrid('clearSelections'); return false; }; this.reject = function () { grid.datagrid('rejectChanges'); }; this.accept = function () { grid.datagrid('acceptChanges'); var rows = grid.datagrid('getRows'); for (var i in rows) delete rows[i]._isnew; }; this.getChanges = function (include, ignore) { if (!include) include = [], ignore = true; var deleted = com.filterProperties(grid.datagrid('getChanges', \"deleted\"), include, ignore), updated = com.filterProperties(grid.datagrid('getChanges', \"updated\"), include, ignore), inserted = com.filterProperties(grid.datagrid('getChanges', \"inserted\"), include, ignore); var changes = { deleted: deleted, inserted: com.minusArray(inserted, deleted), updated: com.minusArray(updated, deleted) }; changes._changed = (changes.deleted.length + changes.updated.length + changes.inserted.length) &gt; 0; return changes; }; this.isChangedAndValid = function () { return self.ended() &amp;&amp; self.getChanges()._changed; }; this.isValid = function () { return self.ended(); } }, /** * treegrid行内编辑封装、此方法请在treeGrid的onLoadSuccess方法中写，不然会出错，得不到options中的idField */ EditTreeGridViewModel: function (grid) { var self = this, option = grid.treegrid('options'), idField = option.idField; this.begin = function (row) { row = row || grid.treegrid('getSelected'); if (row) { self.editIndex = self.ended() ? row[idField] : self.editIndex; grid.treegrid('beginEdit', self.editIndex); } }; this.ended = function () { if (self.editIndex == undefined) return true; if (grid.treegrid('validateRow', self.editIndex)) { grid.treegrid('endEdit', self.editIndex); self.editIndex = undefined; return true; } grid.treegrid('select', self.editIndex); return false; }; this.addnew = function (rowData, parentId) { if (self.ended()) { if (Object.prototype.toString.call(rowData) != '[object Object]') rowData = {}; rowData = $.extend({ _isnew: true }, rowData), parentId = parentId || ''; if (!rowData[idField]) { if (rowData.Id == null || rowData.Id == undefined) {//随机生成的id不是int型 rowData[idField] = com.uuid(); } else { rowData[idField] = rowData.Id; } } grid.treegrid('append', { parent: parentId, data: [rowData] }); //grid.$element().data(\"datagrid\").insertedRows.push(rowData); grid.treegrid('select', rowData[idField]); self.begin(rowData); } }; this.deleterow = function () { var row = grid.treegrid('getSelected'); if (row) { if (row[idField] == self.editIndex) { grid.treegrid('cancelEdit', self.editIndex); self.editIndex = undefined; } grid.treegrid('remove', row[idField]); grid.$element().data(\"datagrid\").deletedRows.push(row); } }; this.reject = function () { throw \"未实现此方法！\"; }; this.accept = function () { grid.treegrid('acceptChanges'); var rows = grid.$element().datagrid('getRows'); for (var i in rows) delete rows[i]._isnew; }; this.getChanges = function (include, ignore) { if (!include) include = [], ignore = true; var deleted = com.filterProperties(grid.datagrid('getChanges', \"deleted\"), include, ignore), updated = com.filterProperties(grid.datagrid('getChanges', \"updated\"), include, ignore), inserted = com.filterProperties(grid.datagrid('getChanges', \"inserted\"), include, ignore); var changes = { deleted: deleted, inserted: com.minusArray(inserted, deleted), updated: com.minusArray(updated, deleted) }; changes._changed = (changes.deleted.length + changes.updated.length + changes.inserted.length) &gt; 0; return changes; }; this.isChangedAndValid = function () { return self.ended() &amp;&amp; self.getChanges()._changed; }; }, /** * json格式转树状结构 * @param {json} json数据 * @param {String} id的字符串 * @param {String} 父id的字符串 * @param {String} children的字符串 * @return {Array} 数组 */ toTreeData: function (a, idStr, pidStr, childrenStr) { var r = [], hash = {}, len = (a || []).length; for (var i = 0; i &lt; len; i++) { hash[a[i][idStr]] = a[i]; } for (var j = 0; j &lt; len; j++) { var aVal = a[j], hashVP = hash[aVal[pidStr]]; if (hashVP) { !hashVP[childrenStr] &amp;&amp; (hashVP[childrenStr] = []); hashVP[childrenStr].push(aVal); } else { r.push(aVal); } } return r; }, eachTreeRow: function (treeData, eachHandler) { for (var i in treeData) { if (eachHandler(treeData[i]) == false) break; if (treeData[i].children) com.eachTreeRow(treeData[i].children, eachHandler); } }, isInChild: function (treeData, pid, id) { var isChild = false; com.eachTreeRow(treeData, function (curNode) { if (curNode.id == pid) { com.eachTreeRow([curNode], function (row) { if (row.id == id) { isChild = true; return false; } }); return false; } }); return isChild; }, compareObject: function (v1, v2) { var countProps = function (obj) { var count = 0; for (k in obj) if (obj.hasOwnProperty(k)) count++; return count; }; if (typeof (v1) !== typeof (v2)) { return false; } if (typeof (v1) === \"function\") { return v1.toString() === v2.toString(); } if (v1 instanceof Object &amp;&amp; v2 instanceof Object) { if (countProps(v1) !== countProps(v2)) { return false; } var r = true; for (k in v1) { r = com.compareObject(v1[k], v2[k]); if (!r) { return false; } } return true; } else { return v1 === v2; } }, minusArray: function (arr1, arr2) { var arr = []; for (var i in arr1) { var b = true; for (var j in arr2) { if (com.compareObject(arr1[i], arr2[j])) { b = false; break; } } if (b) { arr.push(arr1[i]); } } return arr; }, filterProperties: function (obj, props, ignore) { var ret; if (obj instanceof Array || Object.prototype.toString.call(obj) === \"[object Array]\") { ret = []; for (var k in obj) { if (obj.hasOwnProperty(k)) { ret.push(com.filterProperties(obj[k], props, ignore)); } } } else if (typeof obj === 'object') { ret = {}; if (ignore) { var map = {}; for (var k in props) { if (props.hasOwnProperty(k)) { map[props[k]] = true; } } for (var i in obj) { if (obj.hasOwnProperty(i)) { if (!map[i]) ret[i] = obj[i]; } } } else { for (var i in props) { if (props.hasOwnProperty(i)) { if (typeof props[i] == 'function') continue; var arr = props[i].split(\" as \"); ret[arr[1] || arr[0]] = obj[arr[0]]; } } } } else { ret = obj; } return ret; }, copyProperty: function (obj, sourcePropertyName, newPropertyName, overWrite) { if (obj instanceof Array || Object.prototype.toString.call(obj) === \"[object Array]\") { for (var k in obj) com.copyProperty(obj[k], sourcePropertyName, newPropertyName); } else if (typeof obj === 'object') { if (sourcePropertyName instanceof Array || Object.prototype.toString.call(sourcePropertyName) === \"[object Array]\") { for (var i in sourcePropertyName) { com.copyProperty(obj, sourcePropertyName[i], newPropertyName[i]); } } else if (typeof sourcePropertyName === 'string') { if ((obj[newPropertyName] &amp;&amp; overWrite) || (!obj[newPropertyName])) obj[newPropertyName] = obj[sourcePropertyName]; } } return obj; }, functionComment: function (fn) { return fn.toString().replace(/^.*\\r?\\n?.*\\/\\*|\\*\\/([.\\r\\n]*).+?$/gm, ''); }, /** * 生成随机guid值 * @returns {} */ uuid: function () { var a = \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\".split(\"\"); var h = a, e = [], d = Math.random; var g; e[8] = e[13] = e[18] = e[23] = \"-\"; e[14] = \"4\"; for (var c = 0; c &lt; 36; c++) { if (!e[c]) { g = 0 | d() * 16; e[c] = h[(c == 19) ? (g &amp; 3) | 8 : g &amp; 15]; } } return e.join(\"\").toLowerCase(); }, loadAbp:function(data) { var result; if (data.__abp === true) { result = data.result; } else { result = data; } return result; } }); (function () { function newIframe(url) { var ifrStr = \"&lt;iframe src='\" + url + \"' frameborder=0 style='width:100%;height:99%;border:0' &gt;&lt;/iframe&gt;\"; return ifrStr; } //项目通用操作方法 $.extend(com, { /** * * @param {String} val * @param {String} * @example * val 为 ture 'true' 1 是显示文本 '是' * var objMsg = { \"success\": { text: \"是\", 'case': [true, 'true', 1] }, \"danger\": { text: \"否\", 'case': [false, 'false', 0] } }; */ formatMsg: function (val, objMsg) { var text = \"数据为空\", labelClass = 'warning'; $.each(objMsg, function (i, v) { if (objMsg.hasOwnProperty(i)) { $.each(v['case'], function (j, caseValue) { if (v['case'].hasOwnProperty(j)) { if (val == caseValue) { text = v.text; labelClass = i; return false; } } }); } }); return $.string.format('&lt;span class=\"label label-{0}\"&gt;{1}&lt;/span&gt;', labelClass, text); }, /** * 将true/false 转为文本 是/否 * @param {String/Int/boolean} value */ formatYes: function (value) { var objMsg = { \"success\": { text: \"是\", 'case': [true, 'true', 1] }, \"danger\": { text: \"否\", 'case': [false, 'false', 0] } }; return com.formatMsg(value, objMsg); }, formatEnable: function (value) { var objMsg = { \"success\": { text: \"启用\", 'case': [true, 'true', 1] }, \"danger\": { text: \"禁用\", 'case': [false, 'false', 0] } }; return com.formatMsg(value, objMsg); }, dialog: function (options) { var query = $, fnClose = options.onClose; var uuid = 'dd' + com.uuid(); var opts = $.extend({ modal: true, id: uuid, cache: true, collapsible: true, maximizable: true, html: '', url: '', viewModel: query.noop, onLoadError: function () { abp.message.warn(\"发生了异常的错误，请尝试重新打开!\"); } }, options); opts.onClose = function () { if (query.isFunction(fnClose)) fnClose(); query(this).dialog('destroy'); }; if (query.isFunction(opts.html)) opts.html = com.functionComment(opts.html); else if (/^\\#.*\\-template$/.test(opts.html)) opts.html = $(opts.html).html(); var win = query('&lt;div&gt;&lt;/div&gt;').appendTo('body').html(opts.html); if (opts.url) query.ajax({ async: false, url: opts.url, success: function (d) { win.empty().html(d); } }); var closeBtns = { text: '关闭', iconCls: 'icon-cancel', handler: function () { $('#' + uuid).dialog('close'); } }; if (opts.buttons &amp;&amp; opts.buttons.length &gt; 0) { opts.buttons.push(closeBtns); } else { opts.buttons = [closeBtns]; } var windowHeight = $(window).height(); var windowWidth = $(window).width(); if (opts.height &gt; windowHeight) { opts.height = windowHeight; } if (opts.width &gt; windowWidth) { opts.width = windowWidth; } win.dialog(opts); query.parser.onComplete = function () { opts.viewModel(win); query.parser.onComplete = query.noop; }; query.parser.parse(win); return win; }, /** * 将dialog的按钮置为禁用或者启用，防止多次提交 */ setBusy: function (dialogModal, isOn) { if (isOn) { dialogModal.parent().find(\".dialog-button\").hide(); } else { dialogModal.parent().find(\".dialog-button\").show(); } }, filter: function (formElement, gridElemnt, paramsOrCallback) { var data = $(formElement).formSerialize(); if (typeof (paramsOrCallback) == \"object\") { if (!!paramsOrCallback) { data = $.extend(data, paramsOrCallback); } } else { if ($.isFunction(paramsOrCallback)) { var params = paramsOrCallback(data); if (!!params) { data = $.extend(data, params); } } } var grid = $(gridElemnt); if (grid.datagrid('options').treeField === undefined) { grid.datagrid('unselectAll'); grid.datagrid('load', data); } else { grid.treegrid('options').queryParams = data; grid.treegrid('reload'); } }, refreshTab: function (title) { if (title == undefined || title == \"\") { var currentTab = top.$('#centerTabs').tabs('getSelected'); var url = $($(currentTab.panel('options')).attr('content')).attr('src'); top.$('#centerTabs').tabs('update', { tab: currentTab, options: { href: url } }); currentTab.panel('refresh'); return; } var tab = top.$('#centerTabs').tabs('getTab', title); top.$('#centerTabs').tabs(\"update\", { tab: tab, options: tab.panel('options') }); }, createTab: function (node) { var text = node.text; var url = node.attributes.url; if (top.$('#centerTabs').tabs(\"exists\", text)) { top.$('#centerTabs').tabs(\"select\", text); } else { //新增tab页时，加载进度条 $.messager.progress({ text: '页面加载中....', interval: 100 }); window.setTimeout(function () { $.messager.progress('close'); }, 1000); top.$('#centerTabs').tabs('add', { title: text, content: newIframe(url), closable: true, iconCls: node.iconCls }); } }, /** * 关闭当前的tabs */ closeCurrentTab: function () { var tab = top.$('#centerTabs').tabs('getSelected'); //获取当前选中tabs var index = top.$('#centerTabs').tabs('getTabIndex', tab); //获取当前选中tabs的index top.$('#centerTabs').tabs('close', index); //关闭对应index的tabs }, /** * 编辑前统一提示信息,当Id为0时，说明未选中任何记录，其他时，将Id,作为回调函数的参数 * @param {String} element '#dgGrid' * @param {Function} callback 回调函数 function(id){} id为当前选中的id;node:当前数据记录 * @returns {} */ edit: function (element, callback) { if (!element) { element = '#dgGrid'; } var $grid = $(element); var node = $grid.datagrid('getSelected'); if (!node) { abp.message.warn('在操作之前，请先选中一条记录！'); } else { callback(node.Id, node); } }, /** * * @param {} backendService 后台abp接口服务 * @param {String} element 要操作的列表id * @param {String} message 自定义删除提示信息（默认为\"您确认删除这条记录吗?”） * @param {String} deleteService 后台删除方法名（默认为\"delete\") * @returns {} */ deleted: function (backendService, element, message, deleteService) { var id = 0; if (!element) { element = '#dgGrid'; } var template = '&lt;span style=\"font-weight:bold;\"&gt;{0}&lt;/span&gt;'; if (!message) { message = '您确认删除这条记录吗?'; } if (!deleteService) { deleteService = \"delete\"; } var showMessage = $.string.format(template, message); id = com.getSelectId(element); if (!id) { abp.message.warn('在操作之前，请先选中一条记录！'); } else { abp.message.confirm(showMessage, '系统提示', function (r) { if (r) { backendService[deleteService](id).done(function () { abp.message.success('删除成功'); com.btnRefresh(element); }); } }); } }, /** * * @param {} element */ getSelectId: function (element) { if (!element) { element = '#dgGrid'; } var id = 0; var $grid = $(element); var node = $grid.datagrid('getSelected'); if (node != null) { id = node.Id; } return id; }, btnRefresh: function (element) { if (!element) { element = '#dgGrid'; } var $grid = $(element); if ($grid.datagrid('options').treeField === undefined) { $grid.datagrid('reload').datagrid('clearSelections'); } else { $grid.treegrid('load').treegrid('unselectAll'); } }, setForm: function (id, callback, isLoad, url, pDialog) { if (id == undefined) { id = 0; } if (isLoad == undefined) { isLoad = true; } if (url == undefined) { url = 'GetInfoForEdit?Id=' + id; } else { url = url + '?Id=' + id; } var elemForm; if (pDialog == undefined) { elemForm = $('#editForm'); } else { elemForm = pDialog.find('#editForm'); } abp.ajax( { url: url, success: function (data) { if (isLoad === true) { elemForm.form('load', data); } callback &amp;&amp; callback(data); }, showLoading: false }); }, depJsTree: function (opts) { var depService = abp.services.app.organizationUnit; return depService.getComBoTreeJson(false, { showLoading: false }).done(function (dataJson) { opts.data = dataJson; $('#depTree').tree(opts); }); }, nofind: function (img) { img.src = \"/Content/images/user.png\"; img.onerror = null; //如果错误图片也不存在就会死循环一直跳 }, loadSwithButton: function (pDialog, data) { var switchArray = pDialog.find('#editForm').find('input.easyui-switchbutton.switchbutton-f'); $.each(switchArray, function (i, v) { var id = $(v).attr('id'); if (data &amp;&amp; data.hasOwnProperty(id)) { pDialog.find('#' + id) .switchbutton((data[id] === true || data[id] === 1) ? 'check' : 'uncheck'); } }); }, loadCityPicker: function (e, province, city, district) { if (province) { e.citypicker({ province: province, city: city || \"\", district: district || \"\" }); } else { e.citypicker(); } $('.city-picker-span').css(\"width\", \"270px\"); }, formatAddress: function (row, arrayData) { var result = ''; if (arrayData &amp;&amp; arrayData.length &gt; 0) { $.each(arrayData, function (i, v) { if (v != null &amp;&amp; v != \"\") { result += row[v] + \"-\"; } }); } result = result.substring(0, result.length - 1); return result; }, loadCheckBox: function (element, data) { var checkboxArray = $(element).find('input.easyui-checkbox'); $.each(checkboxArray, function (i, v) { var id = $(v).attr('id'); if (data &amp;&amp; data.hasOwnProperty(id)) { $(element).find('#' + id) .checkbox((data[id] === true || data[id] === 1) ? 'check' : 'uncheck'); } }); }, selectIcon: function (formId) { com.dialog({ id: \"select-icon\", title: '选取图标', href: '/Admin/SysMenu/Icon', width: \"1000\", height: \"70%\" }); }, /** * 默认不清空Id的数据 * @param {} formElement form表单element * @param {} gridElement grid列表的element * @param {} paramsOrCallback 额外的参数或者回调函数 * @returns {} */ clear: function (formElement, gridElement, paramsOrCallback) { com.clearById(\"Id\", formElement, gridElement, paramsOrCallback); }, /** * 清空Id以外的所有文本框的值 * @param {} id 不清空字段 * @param {} formElement * @param {} gridElement * @param {} paramsOrCallback * @returns {} */ clearById: function (id, formElement, gridElement, paramsOrCallback) { var grid = $(gridElement); $(formElement).form('clear'); com.json = {}; //清空数据 if (grid.datagrid('options').treeField === undefined) { grid.datagrid('unselectAll'); if (typeof (paramsOrCallback) == \"object\") { if (!!paramsOrCallback) { com.json = $.extend(com.json, paramsOrCallback); } } else { if ($.isFunction(paramsOrCallback)) { var params = paramsOrCallback(com.json); if (!!params) { com.json = $.extend(com.json, params); } } } grid.datagrid('load', com.json); } else { grid.treegrid('options').queryParams = com.json; grid.treegrid('reload'); } $(formElement).find('.select-item').html(\"\"); $(formElement).find('.title').html(\"\"); $(formElement).find('.placeholder').show(); }, /** * 控制按钮的授权 * @param {Array} toolbar 当前菜单对应的按钮权限 * @returns {Array} 返回当前用户拥有的按钮权限 * @example var baseEnCode = \"Admin.OrganizationUnit.\"; var toolbar = [ { 'text': '刷新', iconCls: 'icon-reload', handler: function() { com.btnRefresh(dgTreeGridId); },EnCode:baseEnCode+'GetTreeGrid' }, { 'text': '新增', iconCls: 'icon-add', handler: gridUI.btnAdd, EnCode: baseEnCode + 'Add' }, { 'text': '编辑', iconCls: 'icon-edit', handler: gridUI.btnEdit, EnCode: baseEnCode + 'Edit'}, { 'text': '删除', iconCls: 'icon-remove', handler: gridUI.btnDelete, EnCode: baseEnCode + 'Delete' } ]; toolbar = com.authorizeButton(toolbar); */ authorizeButton: function (toolbar) { var grantedPermissions = abp.auth.grantedPermissions; var newToolbar = []; if (grantedPermissions &amp;&amp; toolbar &amp;&amp; toolbar.length &gt; 0) { newToolbar = toolbar.filter(function (v) { var hasPermssion = grantedPermissions[v.EnCode]; return v.EnCode == undefined || grantedPermissions[v.EnCode]; }); } return newToolbar; }, /** * 去除表单中所有按钮,并且将所有文本框置为禁用 * @param {} dom jquery对象 * @param {Boolean} hasButton * @example com.ignoreEle($('#editForm')); */ ignoreEle: function (dom, hasButton) { if (hasButton == undefined||hasButton==false) { /** * 删除除关闭外的其他按钮 */ dom.find('.dialog-button,.datagrid-toolbar').find('a').each(function (r) { if ($(this).text().trim() != '关闭') { $(this).remove(); } }); dom.find('button.btn').each(function (r) { if ($(this).text().trim() != '关闭') { $(this).remove(); } }); dom.parent().parent().find('.dialog-button').find('a').each(function (r) { if ($(this).text().trim() != '关闭') { $(this).remove(); } }); } dom.find('input,select,textarea').not('input[type=hidden]').each(function (r) { var $this = $(this); var name = $this.attr('id'); try { $this.combobox('disable'); } catch (e) { } switch (true) { case $this.is(\"[class*=easyui-textbox]\"): $this.textbox('disable'); break; case $this.is(\"[class*=easyui-switchbutton]\"): $this.switchbutton('disable'); break; case $this.is(\"[class*=easyui-combobox]\"): $this.combo('disable'); break; case $this.is(\"[class*=easyui-numberbox]\"): $this.numberbox('disable'); break; default: $this.css('border', 'none'); $this.attr('disabled', 'disabled'); $this.attr('readonly', 'readonly'); break; } }); }, /** * 以Post形式打开新页面,可传递参数 * @param {string}url * @param {Object}formData */ openPostWindow: function (url, formData) { var tempForm = document.createElement(\"form\"); tempForm.id = \"tempForm1\"; tempForm.method = \"post\"; tempForm.action = url; tempForm.target = \"_blank\"; $.each(formData, function (i, v) { var hideInput1 = document.createElement(\"input\"); hideInput1.type = \"hidden\"; hideInput1.name = i; //后台要接受这个参数来取值 hideInput1.value = v; //后台实际取到的值 tempForm.appendChild(hideInput1); }); if (document.all) { tempForm.attachEvent(\"onsubmit\", function () { }); //IE } else { var subObj = tempForm.addEventListener(\"submit\", function () { }, false); //firefox } document.body.appendChild(tempForm); if (document.all) { tempForm.fireEvent(\"onsubmit\"); } else { tempForm.dispatchEvent(new Event(\"submit\")); } tempForm.submit(); document.body.removeChild(tempForm); }, /** * 得到IE浏览器的版本号 * @returns {string} 7/8/9/10/6/edge/11/-1 -1非ie浏览器 */ IEVersion: function () { var userAgent = navigator.userAgent; //取得浏览器的userAgent字符串 var isIe = userAgent.indexOf(\"compatible\") &gt; -1 &amp;&amp; userAgent.indexOf(\"MSIE\") &gt; -1; //判断是否IE&lt;11浏览器 var isEdge = userAgent.indexOf(\"Edge\") &gt; -1 &amp;&amp; !isIe; //判断是否IE的Edge浏览器 var isIe11 = userAgent.indexOf('Trident') &gt; -1 &amp;&amp; userAgent.indexOf(\"rv:11.0\") &gt; -1; if (isIe) { var reIe = new RegExp(\"MSIE (\\\\d+\\\\.\\\\d+);\"); reIe.test(userAgent); var fIeVersion = parseFloat(RegExp[\"$1\"]); if (fIeVersion == 7) { return 7; } else if (fIeVersion == 8) { return 8; } else if (fIeVersion == 9) { return 9; } else if (fIeVersion == 10) { return 10; } else { return 6; //IE版本&lt;=7 } } else if (isEdge) { return 'edge'; //edge } else if (isIe11) { return 11; //IE11 } else { return -1; //不是ie浏览器 } }, formatCombobox: function (value, key) { var objSpan = {}; $.each(com[key], function (i, v) { objSpan[v.id] = v.text; }); return objSpan[value]; }, formatDate: function (value, row) { if (value != null &amp;&amp; value != \"\") { return value.split(' ')[0]; } else { return \"\"; } }, /** * 限制自定义上传格式 */ accept: { excel: { title: 'excel', extensions: 'xls,xlsx,csv', mimeTypes: 'application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,.csv' }, txt: { title: 'txt', extensions: 'txt', mimeTypes: 'text/plain' }, spss: { title: 'spss', extensions: 'sav', mimeTypes: '.sav' } }, enumsToCombox: function (data) { var dataArray = []; $.each(data, function (i, v) { dataArray.push({ id: v.id, text: v.text }); }); return dataArray; }, guid: { empty: \"00000000-0000-0000-0000-000000000000\" }, /** * 将表格导出成excel * @param {string} elemId 表格选择器 * @param {string} newName 导出的新表格名称 */ exportExcel: function (elemId, newName) { if (newName == undefined) { newName = com.uuid(); } $(elemId).table2excel({ name: newName, exclude: '.noExl', filename: newName, exclude_img: true, exclude_links: true, exclude_inputs: true }); }, /** * 将表格导出成word * @param {string} tableElem 表格选择器 * @param {string} newFileName 导出的excel的文件名 */ exportWord: function (tableElem, newFileName) { var style = '&lt;style&gt;table{ width:100%;text-align:center;}\\ table, th, td\\ {\\ border: 1px solid blue;\\ }\\ table\\ {\\ border-collapse: collapse;\\ }\\ table, th, td\\ {\\ border: 1px solid black;\\ }' + '.layui-layer-content { padding: 30px; }\\ .table &gt; thead: first-child &gt; tr: first-child &gt; td { border-top: 1px solid #d0d0d0; border-bottom: 1px solid #d0d0d0; }\\ .table &gt; tbody &gt; tr &gt; td, .table &gt; thead &gt; tr &gt; td { padding: 12px; border-left: 1px solid #d0d0d0; border-top: 1px solid #d0d0d0; }\\ .table: last-child { border-left: none; border-right: 1px solid #d0d0d0; }\\ .table &gt; tbody &gt; tr.border-bottom &gt; td { border-bottom: 1px solid #d0d0d0; }\\ .table &gt; thead &gt; tr { background-color: #d4ebf1; font-weight: bold; }\\ .table-head { padding-right: 17px; color: #000; }\\ .table-body { width: 100%; height: 394px;}\\ .table-head table, .table-body table { width: 100 %; }&lt;/style&gt; '; var tempRows = \"\"; $(tableElem +'&gt;tbody&gt;tr,'+tableElem+'&gt;thead&gt;tr').not('.noExl').each(function (i, p) { tempRows += \"&lt;tr&gt;\"; $(p).children(\"td,th\").not('.noExl').each(function (i, q) { var rc = { rows: $(this).attr(\"rowspan\"), cols: $(this).attr(\"colspan\"), flag: $(q).find('.noExl') }; if (rc.flag.length &gt; 0) { tempRows += \"&lt;td&gt; &lt;/td&gt;\"; // exclude it!! } else { if (rc.rows &amp; rc.cols) { tempRows += \"&lt;td&gt;\" + $(q).html() + \"&lt;/td&gt;\"; } else { tempRows += \"&lt;td\"; if (rc.rows &gt; 0) { tempRows += \" rowspan=\\'\" + rc.rows + \"\\' \"; } if (rc.cols &gt; 0) { tempRows += \" colspan=\\'\" + rc.cols + \"\\' \"; } tempRows += \"/&gt;\" + $(q).html() + \"&lt;/td&gt;\"; } } }); tempRows += \"&lt;/tr&gt;\"; }); com.openPostWindow('/File/ExportDoc', { tableHtml: style + \"&lt;table&gt;\" + tempRows+\"&lt;/table&gt;\", newFileName: newFileName }); }, exportGrid: function (dgGridId, isAll) { var opts = $(dgGridId).datagrid('options'); if (isAll == undefined) { isAll = true; } var eventData = $.fn.datagrid.extensions.parseContextMenuEventData($(dgGridId), opts, null); $.messager.progress(); setTimeout(function () { $.messager.progress('close'); }, 1000); $('#searchForm').form('submit', { url: opts.exportUrl, onSubmit: function (param) { param.page = eventData.page; param.rows = eventData.pageSize; param.sort = eventData.sort; param.order = eventData.order; param.isAll = isAll; }, success: function () { } }); //alert(\"导出\" + (isAll ? \"全部\" : \"当前页\") + \"数据\"); }, /** * 导入excel文件 * @param {string} excelName excel的文件名无后缀 * @param {string} importUrl 导入文件的后台地址 * @param {Object}extendParams 上传文件时，增加其他参数传递 * @param {function} callback 上传成功后，点击确认按钮的回调事件 */ btnImport: function (excelName, importUrl, extendParams,callback) { var pDialog = com.dialog({ title: \"导入\", width: '620', height: '320', href: \"/File/ImportDetailModal?excelName=\" + encodeURIComponent(excelName), buttons: [{ text: '确认', iconCls: 'icon-ok', handler: function () { var fileToken = GetFilesAddress(); if (fileToken == \"\") { abp.message.warn('请先选择导入的文件！'); return; } com.setBusy(pDialog, true); var params = {}; if (extendParams != undefined) { params = $.extend(extendParams, { fileToken: fileToken }); } else { params = { fileToken: fileToken } } abp.ajax({ url: importUrl, data: JSON.stringify(params) }).done(function (d) { abp.message.success(d); com.setBusy(pDialog, false); callback &amp;&amp; callback(); com.filter('#searchForm', '#dgGrid'); pDialog.dialog('close'); }); } }] }); }, /** * 填写单个提示信息，增加表单验证功能 * @param {string} promptMessage 提示信息 * @param {function} okCallback 确定时的回调事件 */ prompt: function (promptMessage, okCallback) { var pDialog = com.dialog({ title: '提示信息', cls:'prompt-center', minimizable: false, maximizable: false, width: 300, height: 189, href: '/File/PromptModal?promptMessage=' + encodeURIComponent(promptMessage), buttons: [ { text: '确定', iconCls: 'icon-ok', handler: function () { var valid = pDialog.find('form').form('validate'); if (!valid) return false; okCallback &amp;&amp; okCallback(pDialog); } } ] }); }, /** * 弹出显示pdf的框 * @param {string} title 标题 * @param {string} pdfName pdf的token，即后台存的文件名 */ pdfModal: function(title,pdfName) { com.dialog({ title: title, href: '/File/PdfChartModal?fileToken=' + pdfName, fit:true }); }, /** * 修改验证码 * @param {element} that 当前图片对象 * @example &lt;img src=\"/Account/GetAuthCode\" title=\"单击可刷新\" alt=\"单击可刷新\" onclick=\"com.changeCode(this);\" /&gt; */ changeCode:function(that) { $(that).attr('src', '/Account/GetAuthCode?r='+com.uuid()); } }); })(); × Search results Close "},"others_spinjs_spin.js.html":{"id":"others_spinjs_spin.js.html","title":"Source: others/spinjs/spin.js","body":" Common Modules Global acceptauthorizeButtonbaseUrlbtnImportbytesToSizechangeCodeclearclearByIdcloseCurrentTabconfigdeleteallrowsdeletededitEditGridViewModelEditTreeGridViewModelexportExcelexportWordformatformatMsgformatYesgetSelectIdgetWebUploadGUIDIEVersionignoreEleimagePreviewDialogisNullOrEmptylinesloadFileopacityopenPostWindowpdfModalpromptscrollTosearchsetBusyshow404showChildrenspinstoptemplatetemplateImgtoTreeDatauuidwebuploader Source: others/spinjs/spin.js /** * Copyright (c) 2011-2014 Felix Gnass * Licensed under the MIT license */ (function(root, factory) { /* CommonJS */ if (typeof exports == 'object') module.exports = factory() /* AMD module */ else if (typeof define == 'function' &amp;&amp; define.amd) define(factory) /* Browser global */ else root.Spinner = factory() } (this, function() { \"use strict\"; var prefixes = ['webkit', 'Moz', 'ms', 'O'] /* Vendor prefixes */ , animations = {} /* Animation rules keyed by their name */ , useCssAnimations /* Whether to use CSS animations or setTimeout */ /** * Utility function to create elements. If no tag name is given, * a DIV is created. Optionally properties can be passed. */ function createEl(tag, prop) { var el = document.createElement(tag || 'div') , n for(n in prop) el[n] = prop[n] return el } /** * Appends children and returns the parent. */ function ins(parent /* child1, child2, ...*/) { for (var i=1, n=arguments.length; i&lt;n; i++) parent.appendChild(arguments[i]) return parent } /** * Insert a new stylesheet to hold the @keyframe or VML rules. */ var sheet = (function() { var el = createEl('style', {type : 'text/css'}) ins(document.getElementsByTagName('head')[0], el) return el.sheet || el.styleSheet }()) /** * Creates an opacity keyframe animation rule and returns its name. * Since most mobile Webkits have timing issues with animation-delay, * we create separate rules for each line/segment. */ function addAnimation(alpha, trail, i, lines) { var name = ['opacity', trail, ~~(alpha*100), i, lines].join('-') , start = 0.01 + i/lines * 100 , z = Math.max(1 - (1-alpha) / trail * (100-start), alpha) , prefix = useCssAnimations.substring(0, useCssAnimations.indexOf('Animation')).toLowerCase() , pre = prefix &amp;&amp; '-' + prefix + '-' || '' if (!animations[name]) { sheet.insertRule( '@' + pre + 'keyframes ' + name + '{' + '0%{opacity:' + z + '}' + start + '%{opacity:' + alpha + '}' + (start+0.01) + '%{opacity:1}' + (start+trail) % 100 + '%{opacity:' + alpha + '}' + '100%{opacity:' + z + '}' + '}', sheet.cssRules.length) animations[name] = 1 } return name } /** * Tries various vendor prefixes and returns the first supported property. */ function vendor(el, prop) { var s = el.style , pp , i prop = prop.charAt(0).toUpperCase() + prop.slice(1) for(i=0; i&lt;prefixes.length; i++) { pp = prefixes[i]+prop if(s[pp] !== undefined) return pp } if(s[prop] !== undefined) return prop } /** * Sets multiple style properties at once. */ function css(el, prop) { for (var n in prop) el.style[vendor(el, n)||n] = prop[n] return el } /** * Fills in default values. */ function merge(obj) { for (var i=1; i &lt; arguments.length; i++) { var def = arguments[i] for (var n in def) if (obj[n] === undefined) obj[n] = def[n] } return obj } /** * Returns the absolute page-offset of the given element. */ function pos(el) { var o = { x:el.offsetLeft, y:el.offsetTop } while((el = el.offsetParent)) o.x+=el.offsetLeft, o.y+=el.offsetTop return o } /** * Returns the line color from the given string or array. */ function getColor(color, idx) { return typeof color == 'string' ? color : color[idx % color.length] } // Built-in defaults var defaults = { lines: 12, // The number of lines to draw length: 7, // The length of each line width: 5, // The line thickness radius: 10, // The radius of the inner circle rotate: 0, // Rotation offset corners: 1, // Roundness (0..1) color: '#000', // #rgb or #rrggbb direction: 1, // 1: clockwise, -1: counterclockwise speed: 1, // Rounds per second trail: 100, // Afterglow percentage opacity: 1/4, // Opacity of the lines fps: 20, // Frames per second when using setTimeout() zIndex: 2e9, // Use a high z-index by default className: 'spinner', // CSS class to assign to the element top: '50%', // center vertically left: '50%', // center horizontally position: 'absolute' // element position } /** The constructor */ function Spinner(o) { this.opts = merge(o || {}, Spinner.defaults, defaults) } // Global defaults that override the built-ins: Spinner.defaults = {} merge(Spinner.prototype, { /** * Adds the spinner to the given target element. If this instance is already * spinning, it is automatically removed from its previous target b calling * stop() internally. */ spin: function(target) { this.stop() var self = this , o = self.opts , el = self.el = css(createEl(0, {className: o.className}), {position: o.position, width: 0, zIndex: o.zIndex}) , mid = o.radius+o.length+o.width if (target) { target.insertBefore(el, target.firstChild||null) css(el, { left: o.left, top: o.top }) } el.setAttribute('role', 'progressbar') self.lines(el, self.opts) if (!useCssAnimations) { // No CSS animation support, use setTimeout() instead var i = 0 , start = (o.lines - 1) * (1 - o.direction) / 2 , alpha , fps = o.fps , f = fps/o.speed , ostep = (1-o.opacity) / (f*o.trail / 100) , astep = f/o.lines ;(function anim() { i++; for (var j = 0; j &lt; o.lines; j++) { alpha = Math.max(1 - (i + (o.lines - j) * astep) % f * ostep, o.opacity) self.opacity(el, j * o.direction + start, alpha, o) } self.timeout = self.el &amp;&amp; setTimeout(anim, ~~(1000/fps)) })() } return self }, /** * Stops and removes the Spinner. */ stop: function() { var el = this.el if (el) { clearTimeout(this.timeout) if (el.parentNode) el.parentNode.removeChild(el) this.el = undefined } return this }, /** * Internal method that draws the individual lines. Will be overwritten * in VML fallback mode below. */ lines: function(el, o) { var i = 0 , start = (o.lines - 1) * (1 - o.direction) / 2 , seg function fill(color, shadow) { return css(createEl(), { position: 'absolute', width: (o.length+o.width) + 'px', height: o.width + 'px', background: color, boxShadow: shadow, transformOrigin: 'left', transform: 'rotate(' + ~~(360/o.lines*i+o.rotate) + 'deg) translate(' + o.radius+'px' +',0)', borderRadius: (o.corners * o.width&gt;&gt;1) + 'px' }) } for (; i &lt; o.lines; i++) { seg = css(createEl(), { position: 'absolute', top: 1+~(o.width/2) + 'px', transform: o.hwaccel ? 'translate3d(0,0,0)' : '', opacity: o.opacity, animation: useCssAnimations &amp;&amp; addAnimation(o.opacity, o.trail, start + i * o.direction, o.lines) + ' ' + 1/o.speed + 's linear infinite' }) if (o.shadow) ins(seg, css(fill('#000', '0 0 4px ' + '#000'), {top: 2+'px'})) ins(el, ins(seg, fill(getColor(o.color, i), '0 0 1px rgba(0,0,0,.1)'))) } return el }, /** * Internal method that adjusts the opacity of a single line. * Will be overwritten in VML fallback mode below. */ opacity: function(el, i, val) { if (i &lt; el.childNodes.length) el.childNodes[i].style.opacity = val } }) function initVML() { /* Utility function to create a VML tag */ function vml(tag, attr) { return createEl('&lt;' + tag + ' xmlns=\"urn:schemas-microsoft.com:vml\" class=\"spin-vml\"&gt;', attr) } // No CSS transforms but VML support, add a CSS rule for VML elements: sheet.addRule('.spin-vml', 'behavior:url(#default#VML)') Spinner.prototype.lines = function(el, o) { var r = o.length+o.width , s = 2*r function grp() { return css( vml('group', { coordsize: s + ' ' + s, coordorigin: -r + ' ' + -r }), { width: s, height: s } ) } var margin = -(o.width+o.length)*2 + 'px' , g = css(grp(), {position: 'absolute', top: margin, left: margin}) , i function seg(i, dx, filter) { ins(g, ins(css(grp(), {rotation: 360 / o.lines * i + 'deg', left: ~~dx}), ins(css(vml('roundrect', {arcsize: o.corners}), { width: r, height: o.width, left: o.radius, top: -o.width&gt;&gt;1, filter: filter }), vml('fill', {color: getColor(o.color, i), opacity: o.opacity}), vml('stroke', {opacity: 0}) // transparent stroke to fix color bleeding upon opacity change ) ) ) } if (o.shadow) for (i = 1; i &lt;= o.lines; i++) seg(i, -2, 'progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)') for (i = 1; i &lt;= o.lines; i++) seg(i) return ins(el, g) } Spinner.prototype.opacity = function(el, i, val, o) { var c = el.firstChild o = o.shadow &amp;&amp; o.lines || 0 if (c &amp;&amp; i+o &lt; c.childNodes.length) { c = c.childNodes[i+o]; c = c &amp;&amp; c.firstChild; c = c &amp;&amp; c.firstChild if (c) c.opacity = val } } } var probe = css(createEl('group'), {behavior: 'url(#default#VML)'}) if (!vendor(probe, 'transform') &amp;&amp; probe.adj) initVML() else useCssAnimations = vendor(probe, 'animation') return Spinner })); × Search results Close "},"global.html":{"id":"global.html","title":"Global","body":" Common Modules Global acceptauthorizeButtonbaseUrlbtnImportbytesToSizechangeCodeclearclearByIdcloseCurrentTabconfigdeleteallrowsdeletededitEditGridViewModelEditTreeGridViewModelexportExcelexportWordformatformatMsgformatYesgetSelectIdgetWebUploadGUIDIEVersionignoreEleimagePreviewDialogisNullOrEmptylinesloadFileopacityopenPostWindowpdfModalpromptscrollTosearchsetBusyshow404showChildrenspinstoptemplatetemplateImgtoTreeDatauuidwebuploader Global Members accept 限制自定义上传格式 Source: ProjectLib/base.js, line 1005 baseUrl 服务层api访问s根地址 Source: ProjectLib/base.js, line 19 config Source: ProjectLib/base.js, line 13 webuploader 上传控件实现 Source: libs/abp.webuploader.js, line 10 Example 该js还是依赖于以下js &lt;link href=\"~/bower_components/font-awesome/css/font-awesome.min.css\" rel=\"stylesheet\" /&gt; &lt;script src=\"~/bower_components/jquery/jquery.min.js\"&gt;&lt;/script&gt; &lt;script src=\"~/bower_components/layer/layer.js\"&gt;&lt;/script&gt; &lt;script src=\"~/Scripts/libs/abp.js\"&gt;&lt;/script&gt; &lt;script src=\"~/Scripts/libs/abp.layui-alert.js\"&gt;&lt;/script&gt; Methods authorizeButton(toolbar) → {Array} 控制按钮的授权 Parameters: Name Type Description toolbar Array 当前菜单对应的按钮权限 Source: ProjectLib/base.js, line 850 Returns: 返回当前用户拥有的按钮权限 Type Array Example var baseEnCode = \"Admin.OrganizationUnit.\"; var toolbar = [ { 'text': '刷新', iconCls: 'icon-reload', handler: function() { com.btnRefresh(dgTreeGridId); },EnCode:baseEnCode+'GetTreeGrid' }, { 'text': '新增', iconCls: 'icon-add', handler: gridUI.btnAdd, EnCode: baseEnCode + 'Add' }, { 'text': '编辑', iconCls: 'icon-edit', handler: gridUI.btnEdit, EnCode: baseEnCode + 'Edit'}, { 'text': '删除', iconCls: 'icon-remove', handler: gridUI.btnDelete, EnCode: baseEnCode + 'Delete' } ]; toolbar = com.authorizeButton(toolbar); btnImport(excelName, importUrl, extendParams, callback) 导入excel文件 Parameters: Name Type Description excelName string excel的文件名无后缀 importUrl string 导入文件的后台地址 extendParams Object 上传文件时，增加其他参数传递 callback function 上传成功后，点击确认按钮的回调事件 Source: ProjectLib/base.js, line 1150 bytesToSize(bytes) 1024MB转换成1GB Parameters: Name Type Description bytes number Source: libs/abp.webuploader.js, line 700 Returns: 返回最小不可转换的单位的空间大小 changeCode(that) 修改验证码 Parameters: Name Type Description that element 当前图片对象 Source: ProjectLib/base.js, line 1235 Example &lt;img src=\"/Account/GetAuthCode\" title=\"单击可刷新\" alt=\"单击可刷新\" onclick=\"com.changeCode(this);\" /&gt; clear(formElement, gridElement, paramsOrCallback) 默认不清空Id的数据 Parameters: Name Type Description formElement form表单element gridElement grid列表的element paramsOrCallback 额外的参数或者回调函数 Source: ProjectLib/base.js, line 790 Returns: clearById(id, formElement, gridElement, paramsOrCallback) 清空Id以外的所有文本框的值 Parameters: Name Type Description id 不清空字段 formElement gridElement paramsOrCallback Source: ProjectLib/base.js, line 801 Returns: closeCurrentTab() 关闭当前的tabs Source: ProjectLib/base.js, line 596 deleteallrows() addnew 多行之后 若是出现删除bug，可在addnew 之后 调用 grid.datagrid('clearSelections'); Source: ProjectLib/base.js, line 74 deleted(backendService, element, message, deleteService) Parameters: Name Type Description backendService 后台abp接口服务 element String 要操作的列表id message String 自定义删除提示信息（默认为\"您确认删除这条记录吗?”） deleteService String 后台删除方法名（默认为\"delete\") Source: ProjectLib/base.js, line 627 Returns: edit(element, callback) 编辑前统一提示信息,当Id为0时，说明未选中任何记录，其他时，将Id,作为回调函数的参数 Parameters: Name Type Description element String '#dgGrid' callback function 回调函数 function(id){} id为当前选中的id;node:当前数据记录 Source: ProjectLib/base.js, line 607 Returns: EditGridViewModel(grid) datagrid行内编辑封装 Parameters: Name Type Description grid element $('#dgGrid') Source: ProjectLib/base.js, line 30 Returns: EditTreeGridViewModel() treegrid行内编辑封装、此方法请在treeGrid的onLoadSuccess方法中写，不然会出错，得不到options中的idField Source: ProjectLib/base.js, line 124 exportExcel(elemId, newName) 将表格导出成excel Parameters: Name Type Description elemId string 表格选择器 newName string 导出的新表格名称 Source: ProjectLib/base.js, line 1041 exportWord(tableElem, newFileName) 将表格导出成word Parameters: Name Type Description tableElem string 表格选择器 newFileName string 导出的excel的文件名 Source: ProjectLib/base.js, line 1059 format(\"{0}-{1}\",\"a\",\"b\") 格式化字符串 Parameters: Name Type Description \"{0}-{1}\",\"a\",\"b\" string Source: libs/abp.webuploader.js, line 674 Returns: a-b Example 用法: webuploader.format(\"{0}-{1}\",\"a\",\"b\"); formatMsg(val) Parameters: Name Type Description val String String Source: ProjectLib/base.js, line 404 Example val 为 ture 'true' 1 是显示文本 '是' var objMsg = { \"success\": { text: \"是\", 'case': [true, 'true', 1] }, \"danger\": { text: \"否\", 'case': [false, 'false', 0] } }; formatYes(value) 将true/false 转为文本 是/否 Parameters: Name Type Description value String/Int/boolean Source: ProjectLib/base.js, line 428 getSelectId(element) Parameters: Name Type Description element Source: ProjectLib/base.js, line 660 getWebUpload(callback) 动态加载webuploader控件 Parameters: Name Type Description callback any Source: libs/abp.webuploader.js, line 509 GUID() 生成一个guid数据 Source: libs/abp.webuploader.js, line 692 IEVersion() → {string} 得到IE浏览器的版本号 Source: ProjectLib/base.js, line 959 Returns: 7/8/9/10/6/edge/11/-1 -1非ie浏览器 Type string ignoreEle(dom, hasButton) 去除表单中所有按钮,并且将所有文本框置为禁用 Parameters: Name Type Description dom jquery对象 hasButton Boolean Source: ProjectLib/base.js, line 867 Example com.ignoreEle($('#editForm')); imagePreviewDialog($ele) webuploader的图片预览效果 Parameters: Name Type Description $ele 当前点击的图片elem Source: libs/abp.webuploader.js, line 500 isNullOrEmpty() 判断变量是否为null或空 Source: libs/abp.webuploader.js, line 686 Example 用法: webuploader.isNullOrEmpty(null) lines() Internal method that draws the individual lines. Will be overwrittenin VML fallback mode below. Source: others/spinjs/spin.js, line 234 loadFile() 编辑时，加载上传控件 Parameters: Type Description Source: libs/abp.webuploader.js, line 587 opacity() Internal method that adjusts the opacity of a single line.Will be overwritten in VML fallback mode below. Source: others/spinjs/spin.js, line 271 openPostWindow(url, formData) 以Post形式打开新页面,可传递参数 Parameters: Name Type Description url string formData Object Source: ProjectLib/base.js, line 926 pdfModal(title, pdfName) 弹出显示pdf的框 Parameters: Name Type Description title string 标题 pdfName string pdf的token，即后台存的文件名 Source: ProjectLib/base.js, line 1223 prompt(promptMessage, okCallback) 填写单个提示信息，增加表单验证功能 Parameters: Name Type Description promptMessage string 提示信息 okCallback function 确定时的回调事件 Source: ProjectLib/base.js, line 1196 scrollTo() 将滚动条滚动到指定的节点位置，使该节点可见（如果有滚动条才滚动，没有滚动条就不滚动） Parameters: Type Description Source: ProjectLib/easyui.default-extension.js, line 227 search(tree, searchText, this-context) 扩展easyui tree的搜索方法 Parameters: Name Type Description tree easyui tree的根DOM节点(UL节点)的jQuery对象 searchText 检索的文本 this-context easyui tree的tree对象 Source: ProjectLib/easyui.default-extension.js, line 148 setBusy() 将dialog的按钮置为禁用或者启用，防止多次提交 Source: ProjectLib/base.js, line 517 show404(img) 当图片没有时，会显示404图片 Parameters: Name Type Description img Source: libs/abp.webuploader.js, line 572 Returns: showChildren(node) 展示节点的子节点（子节点有可能在搜索的过程中被隐藏了） Parameters: Name Type Description node easyui tree节点 Source: ProjectLib/easyui.default-extension.js, line 203 spin() Adds the spinner to the given target element. If this instance is alreadyspinning, it is automatically removed from its previous target b callingstop() internally. Source: others/spinjs/spin.js, line 175 stop() Stops and removes the Spinner. Source: others/spinjs/spin.js, line 220 template(isCheck) 上传文件模板 Parameters: Name Type Description isCheck boolean 是否是查看界面 true/false Source: libs/abp.webuploader.js, line 532 Returns: 参数为空时，默认不是查看界面，有删除按钮。参数为true时，无删除按钮 templateImg(isCheck) 图片上传模板 Parameters: Name Type Description isCheck 是否是查看界面 true/false Source: libs/abp.webuploader.js, line 553 Returns: 参数为空时，默认不是查看界面，有删除功能。参数为true时，无删除功能 toTreeData(json数据, id的字符串, 父id的字符串, children的字符串) → {Array} json格式转树状结构 Parameters: Name Type Description json数据 json id的字符串 String 父id的字符串 String children的字符串 String Source: ProjectLib/base.js, line 202 Returns: 数组 Type Array uuid() 生成随机guid值 Source: ProjectLib/base.js, line 353 Returns: × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" Common Modules Global acceptauthorizeButtonbaseUrlbtnImportbytesToSizechangeCodeclearclearByIdcloseCurrentTabconfigdeleteallrowsdeletededitEditGridViewModelEditTreeGridViewModelexportExcelexportWordformatformatMsgformatYesgetSelectIdgetWebUploadGUIDIEVersionignoreEleimagePreviewDialogisNullOrEmptylinesloadFileopacityopenPostWindowpdfModalpromptscrollTosearchsetBusyshow404showChildrenspinstoptemplatetemplateImgtoTreeDatauuidwebuploader libs、开发者日志生成新的tag 并推送到服务器上 生成一个0.0.6版本的标签 git tag 0.0.6 将0.0.6标签提交到git服务器 git push origin 0.0.6 将本地所有标签一次性提交到git服务器 git push origin -–tags文档生成 jsdoc 文档地址：http://www.css88.com/doc/jsdoc/ 官方文档 http://usejsdoc.org/ JSDoc安装 npm install -g jsdoc 安装 Docstrapnpm i ink-docstrap 生成项目 API 文档：jsdoc -c .\\configs\\jsdoc.conf.json docsify 文档生成 相关博客 https://segmentfault.com/a/1190000007656679?_ea=1416350 文档地址https://docsify.js.org/#/zh-cn/quickstart 开发者文档 https://luoyunchong.github.io/staticfiles/#/ × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
